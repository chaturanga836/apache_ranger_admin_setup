"use strict";(self.webpackChunkranger=self.webpackChunkranger||[]).push([[463],{8463:(e,t,a)=>{a.r(t),a.d(t,{PolicyListingTabView:()=>G,default:()=>X});var l=a(6540),r=a(8106),n=a(9567),i=a(5056),c=a(2543),o=a(8651),s=a(6052),d=a(5615),u=a(2735),m=a(4479),p=a(1105),v=a(2465),f=a(4743),y=a.n(f),E=a(6474),g=a(3267),b=a(9423),h=a(3666),w=a(5787),N=a(3328),S=a(8281),D=a(1376);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){x(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function P(e,t,a,l,r,n,i){try{var c=e[n](i),o=c.value}catch(e){return void a(e)}c.done?t(o):Promise.resolve(o).then(l,r)}function k(e){return function(){var t=this,a=arguments;return new Promise((function(l,r){var n=e.apply(t,a);function i(e){P(n,l,r,i,c,"next",e)}function c(e){P(n,l,r,i,c,"throw",e)}i(void 0)}))}}const C=function(e){var t,{serviceDef:a,serviceData:n,serviceZone:i}=e,{state:f}=(0,r.zy)(),[A,x]=(0,l.useState)([]),[P,C]=(0,l.useState)(!0),[j,L]=(0,l.useState)(f&&f.showLastPage?f.addPageData.totalPage:0),[T,I]=(0,l.useState)(f&&f.showLastPage?f.addPageData.totalPage-1:0),[H,R]=(0,l.useState)(f&&f.showLastPage?f.addPageData.pageSize:25),[z,B]=(0,l.useState)(0),[V,_]=(0,l.useState)({totalPage:0,pageRecords:0,pageSize:25}),Z=(0,l.useRef)(0),[F,W]=(0,l.useState)({policyDetails:{},showSyncDetails:!1}),[J,U]=(0,l.useState)(!1),[M,K]=(0,l.useState)(null),[Y,G]=(0,l.useState)(y().now()),[X,Q]=(0,l.useState)(1),[q,$]=(0,l.useState)([]),[ee,te]=(0,o.ok)(),[ae,le]=(0,l.useState)([]),[re,ne]=(0,l.useState)(!0),[ie,ce]=(0,l.useState)({page:0}),[oe,se]=(0,l.useState)(!0),[de,ue]=(0,l.useState)(!1),me=(0,r.Zp)(),{serviceId:pe,policyType:ve}=(0,r.g)(),[fe,ye]=(0,l.useState)(!1),[Ee,ge]=(0,l.useState)(null),[be,he]=(0,l.useState)(""),[we,Ne]=(0,l.useState)(!1),Se=()=>{ge(null),he(""),ye(!1)};(0,l.useEffect)((()=>{var e={},t=[],a=Object.fromEntries([...ee]);for(var l in a){var r=(0,c.find)(ze(),{urlLabel:l});if(!(0,c.isUndefined)(r)){var n=r.category,i=a[l];if("textoptions"==r.type){var o=(0,c.find)(r.options(),{label:i});i=void 0!==o?o.value:i}e[n]=i,t.push({category:n,value:i})}}te(O(O({},a),{}),{replace:!0}),JSON.stringify(q)!==JSON.stringify(e)&&$(e),le(t),ne(!1),localStorage.setItem("newDataAdded",f&&f.showLastPage)}),[ee]),(0,l.useEffect)((()=>{"true"==localStorage.getItem("newDataAdded")&&(0,w.r7)(A)}),[z]);var De,Ae,Oe,xe,Pe,ke=function(){var e=k((function*(e){try{var t=yield(0,g.fetchApi)({url:"plugins/policies/".concat(e)});if(200!==t.status)return void E.oR.error("Error downloading the policy !");var a=t.data||null;a=JSON.parse(JSON.stringify(a)),a=(0,c.omit)(a,["createdBy","createTime","guid","id","resourceSignature","updatedBy","updateTime","version"]);var l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),r=URL.createObjectURL(l),n=document.createElement("a");n.href=r,n.download=a.serviceType+"_"+a.service+"_"+a.name+"-policy_"+e+".json"||0,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}catch(e){E.oR.error("Error downloading the policy !"),console.error("Error fetching data: ",e)}}));return function(t){return e.apply(this,arguments)}}(),Ce=(0,l.useCallback)(function(){var e=k((function*(e){var{pageSize:t,pageIndex:a,sortBy:l,gotoPage:r}=e;C(!0);var n=[],c=[],o=0,s=f&&f.showLastPage?f.addPageData.totalPage-1:a,d=0,u=++Z.current,m=O({},q);if(u===Z.current){var p,v;m.page=s,m.startIndex=f&&f.showLastPage?(f.addPageData.totalPage-1)*t:a*t,m.pageSize=t,m.policyType=ve,l.length>0&&(m.sortBy=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{var{id:t}=e;return(0,h.W5)(t)})).join(",")}(l),m.sortType=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{var{desc:t}=e;return t?"desc":"asc"})).join(",")}(l)),null!==i&&(m.zoneName=i.label);try{n=(c=yield(0,g.fetchApi)({url:"plugins/policies/service/".concat(pe),params:m})).data.policies,o=c.data.totalCount,d=Math.ceil(o/t)}catch(e){console.error("Error occurred while fetching Policies ! ".concat(e))}f&&(f.showLastPage=!1),x(n),_({totalPage:d,pageRecords:null===(p=c)||void 0===p||null===(v=p.data)||void 0===v?void 0:v.totalCount,pageSize:25}),B(o),L(d),I(s),R(t),ce({page:r}),C(!1)}}));return function(t){return e.apply(this,arguments)}}(),[Y,q]),je=()=>{W({policyDetails:{},showPopup:!1})},Le=()=>U(!1),Te=function(){var e=k((function*(e){var t={};try{t=yield(0,g.fetchApi)({url:"plugins/policy/".concat(e,"/versionList")})}catch(e){console.error("Error occurred while fetching Policy Version or CSRF headers! ".concat(e))}Q(t.data.value.split(",").map(Number).sort((function(e,t){return e-t}))),C(!1)}));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=k((function*(e){je();try{ue(!0),yield(0,g.fetchApi)({url:"plugins/policies/".concat(e),method:"DELETE"}),ue(!1),E.oR.success(" Success! Policy deleted successfully")}catch(e){var t,a;ue(!1);var l="Failed to delete policy : ";null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.msgDesc&&(l+=e.response.data.msgDesc),E.oR.error(l),console.error("Error occurred during deleting policy : "+e)}if(1==A.length&&T>0){var r=T-T;"function"==typeof(null==ie?void 0:ie.page)&&ie.page(r)}else G(y().now())}));return function(t){return e.apply(this,arguments)}}(),He=l.useMemo((()=>[{Header:"Policy ID",accessor:"id",Cell:e=>(0,h.Dl)()||(0,h.EH)()?!(0,c.isEmpty)(e.row.original.validitySchedules)&&(0,h.OE)(e.row.original)?l.createElement("div",{className:"position-relative text-center"},l.createElement("i",{className:"fa-fw fa fa-exclamation-circle policy-expire-icon",title:"Policy expired"}),e.value):l.createElement("div",{className:"position-relative text-center"},e.value):!(0,c.isEmpty)(e.row.original.validitySchedules)&&(0,h.OE)(e.row.original)?l.createElement("div",{className:"position-relative text-center"},l.createElement("i",{className:"fa-fw fa fa-exclamation-circle policy-expire-icon",title:"Policy expired"}),l.createElement(o.N_,{title:"Edit",to:"/service/".concat(pe,"/policies/").concat(e.value,"/edit")},e.value)):l.createElement("div",{className:"position-relative text-center"},l.createElement(o.N_,{title:"Edit",to:"/service/".concat(pe,"/policies/").concat(e.value,"/edit")},e.value)),width:90},{Header:"Policy Name",accessor:"name",Cell:e=>l.createElement("span",{className:"text-truncate",title:e.value,style:{maxWidth:"240px",display:"inline-block"}},e.value),width:250},{Header:"Policy Label",accessor:"policyLabels",Cell:e=>(0,c.isEmpty)(e.value)?l.createElement("div",{className:"text-center"},"--"):l.createElement(w.LH,{data:e.value}),width:130,disableSortBy:!0},{Header:"Status",accessor:"isEnabled",Cell:e=>e.value?l.createElement("h6",null,l.createElement(s.A,{bg:"success"},"Enabled")):l.createElement("h6",null,l.createElement(s.A,{bg:"danger"},"Disabled")),width:100,disableSortBy:!0},{Header:"Audit Logging",accessor:"isAuditEnabled",Cell:e=>e.value?l.createElement("h6",null,l.createElement(s.A,{bg:"success"},"Enabled")):l.createElement("h6",null,l.createElement(s.A,{bg:"danger"},"Disabled")),width:110,disableSortBy:!0},{Header:"Roles",accessor:"roles",Cell:e=>{var t=(0,h.yE)("roles",e.row.original,ve);return(0,c.isEmpty)(t)?l.createElement("div",{className:"text-center"},"--"):l.createElement(w.LH,{data:t,key:e.row.original.id})},minWidth:190,disableSortBy:!0},{Header:"Groups",accessor:"groups",Cell:e=>{var t=(0,h.yE)("groups",e.row.original,ve);return(0,c.isEmpty)(t)?l.createElement("div",{className:"text-center"},"--"):l.createElement(w.LH,{data:t,key:e.row.original.id})},minWidth:190,disableSortBy:!0},{Header:"Users",accessor:"users",Cell:e=>{var t=(0,h.yE)("users",e.row.original,ve);return(0,c.isEmpty)(t)?l.createElement("div",{className:"text-center"},"--"):l.createElement(w.LH,{data:t,key:e.row.original.id})},minWidth:190,disableSortBy:!0},{Header:"Actions",accessor:"actions",Cell:e=>{var{row:{original:t}}=e;return l.createElement("div",null,l.createElement(d.A,{variant:"outline-dark",size:"sm",className:"me-2",title:"View",onClick:e=>{var a,l;e.stopPropagation(),a=t,l=(0,c.pick)(a,["id"]),U(!0),K(a),Te(l.id)},"data-name":"viewPolicy","data-id":t.id},l.createElement("i",{className:"fa-fw fa fa-eye fa-fw fa fa-large"})),((0,h.FV)()||(0,h.Xm)()||(0,h.QY)())&&l.createElement(l.Fragment,null,l.createElement(d.A,{className:"me-2",variant:"outline-dark",size:"sm",title:"Download",onClick:()=>ke(t.id),"data-name":"downloadPolicy","data-id":t.id,"data-cy":t.id},l.createElement("i",{className:"fa-fw fa fa-download fa-fw fa fa-large"})),l.createElement(o.N_,{className:"btn btn-outline-dark btn-sm me-2",title:"Edit",to:"/service/".concat(pe,"/policies/").concat(t.id,"/edit")},l.createElement("i",{className:"fa-fw fa fa-edit"})),l.createElement(d.A,{variant:"danger",size:"sm",title:"Delete",onClick:()=>{return e=t.id,a=t.name,void W({policyDetails:{policyID:e,policyName:a},showPopup:!0});var e,a},"data-name":"deletePolicy","data-id":t.id,"data-cy":t.id},l.createElement("i",{className:"fa-fw fa fa-trash fa-fw fa fa-large"}))))},disableSortBy:!0,minWidth:190}]),[]),Re=[{category:"group",label:"Group Name",urlLabel:"groupName",type:"text"},{category:"policyLabelsPartial",label:"Policy Label",urlLabel:"policyLabel",type:"text"},{category:"policyNamePartial",label:"Policy Name",urlLabel:"policyName",type:"text"},{category:"role",label:"Role Name",urlLabel:"roleName",type:"text"},{category:"isEnabled",label:"Status",urlLabel:"status",type:"textoptions",options:()=>[{value:"true",label:"Enabled"},{value:"false",label:"Disabled"}]},{category:"user",label:"User Name",urlLabel:"userName",type:"text"}],ze=()=>{var e=a;if(void 0!==e){var t=(0,h._b)(e,ve),l=null==t?void 0:t.map((e=>({category:"resource:"+e.name,label:e.label,urlLabel:(0,c.camelCase)(e.label),type:"text"})));return(0,c.sortBy)((0,c.concat)(Re,l),["label"])}return(0,c.sortBy)(Re,["label"])};return l.createElement("div",{className:"wrap"},("hdfs"==n.type||"yarn"==n.type)&&oe&&l.createElement(u.A,{variant:"warning",onClose:()=>se(!1),dismissible:!0},l.createElement("i",{className:"fa-fw fa fa-info-circle d-inline text-dark"}),l.createElement("p",{className:"pd-l-10 d-inline"},"By default, fallback to ".concat(D.GW[n.type].label," ACLs are enabled. If access cannot be\n              determined by Ranger policies, authorization will fall back to\n              ").concat(D.GW[n.type].label," ACLs. If this behavior needs to be changed, modify ").concat(D.GW[n.type].label,"\n              plugin config - ").concat(D.GW[n.type].configs,"-authorization."))),re?l.createElement(w.aH,null):l.createElement(l.Fragment,null,l.createElement(w.Yh,{isUiBlock:de}),l.createElement("div",{className:"policy-listing"},l.createElement(m.A,{className:"mb-3"},l.createElement(p.A,{sm:9},l.createElement("div",{className:"filter-icon-wrap"},l.createElement(S.A,{key:"policy-listing-search-filter",placeholder:"Search for your policy...",options:ze(),onChange:e=>{var{searchFilterParam:t,searchParam:a}=(0,h.kI)(e,ze());$(t),te(a,{replace:!0}),"function"==typeof(null==ie?void 0:ie.page)&&ie.page(0)},defaultSelected:ae}),l.createElement(w.tZ,{icon:"fa-fw fa fa-info-circle info-icon",title:l.createElement("span",{style:{fontSize:"14px"}},"Search Filter Hints"),content:(Ae=(0,h._b)(a,ve),Oe=(0,c.map)(Ae,(function(e){return{name:e.name,label:e.label,description:e.description}})),xe=(0,c.map)(Oe,(function(e){return{text:e.label,info:(0,c.isUndefined)(null==e?void 0:e.description)?D.x9[e.name]:e.description}})),Pe=(0,c.union)(D.Eq,xe),l.createElement("div",{className:"policy-search-info"},l.createElement("p",{className:"m-0"},"Wildcard searches ( for example using * or ? ) are not currently supported."),null===(De=Pe)||void 0===De?void 0:De.map(((e,t)=>l.createElement("p",{className:"m-0",key:t},l.createElement("span",{className:"fw-bold"},e.text,": "),l.createElement("span",null,e.info)))))),placement:"bottom",trigger:["hover","focus"]}))),l.createElement(p.A,{sm:3},l.createElement("div",{className:"float-end mb-1"},((0,h.FV)()||(0,h.Xm)()||(0,h.QY)())&&l.createElement("div",null,l.createElement(d.A,{variant:"primary",size:"sm",className:"ms-1",onClick:()=>{me("/service/".concat(pe,"/policies/create/").concat(ve),{state:{tblpageData:V}})},"data-js":"addNewPolicy","data-cy":"addNewPolicy"},"Add New Policy"),l.createElement(d.A,{variant:"primary",size:"sm",className:"ms-1",onClick:()=>{ye(!0)},"data-js":"importNewPolicy","data-cy":"importNewPolicy"},"Import New Policy"))))),l.createElement(b.A,{data:A,columns:He,fetchData:Ce,totalCount:z,pagination:!0,pageCount:j,currentpageIndex:T,currentpageSize:H,loading:P,columnSort:!0})),fe&&l.createElement(v.A,{show:fe,onHide:Se},l.createElement(v.A.Header,{closeButton:!0},l.createElement(v.A.Title,null,"Upload JSON Policy")),l.createElement(v.A.Body,null,l.createElement("input",{type:"file",accept:"application/json",onChange:e=>{var t=e.target.files[0];ge(t),he("")}}),we&&l.createElement("p",null,"Uploading..."),!we&&be&&l.createElement("p",null,be)),l.createElement(v.A.Footer,null,l.createElement(d.A,{size:"sm",variant:"secondary",onClick:Se},"Close"),l.createElement(d.A,{size:"sm",variant:"primary",onClick:()=>{if(Ee){var e=new FileReader;e.onload=function(){var e=k((function*(e){try{var t=JSON.parse(e.target.result);(0,c.has)("service")&&(t.service=n.name),Ne(!0),yield(0,g.fetchApi)({url:"plugins/policies",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(t)}),Ne(!1),he(""),ye(!1),G(y().now()),E.oR.success("Successfully imported policy json file !")}catch(e){Ne(!1),he("Error parsing or processing JSON file: ".concat(e.message)),console.log(e)}}));return function(t){return e.apply(this,arguments)}}(),e.readAsText(Ee)}else he("No file selected !")}},"Upload"))),l.createElement(v.A,{show:F.showPopup,onHide:je},l.createElement(v.A.Header,{closeButton:!0},l.createElement("span",{className:"text-word-break"},'Are you sure you want to delete policy "',l.createElement("b",null,null==F||null===(t=F.policyDetails)||void 0===t?void 0:t.policyName),'" ?')),l.createElement(v.A.Footer,null,l.createElement(d.A,{variant:"secondary",size:"sm",onClick:je},"Close"),l.createElement(d.A,{variant:"primary",size:"sm",onClick:()=>Ie(F.policyDetails.policyID)},"OK"))),l.createElement(v.A,{show:J,onHide:Le,size:"xl"},l.createElement(v.A.Header,{closeButton:!0},l.createElement(v.A.Title,null,"Policy Details")),l.createElement(v.A.Body,null,l.createElement(N.A,{paramsData:M,policyInfo:Ce,totalCount:z,policyView:!0,updateServices:()=>{G(y().now())}})),l.createElement(v.A.Footer,null,l.createElement("div",{className:"policy-version text-start"},l.createElement("span",null,l.createElement("i",{className:M&&M.version>1?"fa-fw fa fa-chevron-left active":"fa-fw fa fa-chevron-left",onClick:e=>e.currentTarget.classList.contains("active")&&(e=>{if(e.currentTarget.classList.contains("active"))var t=M&&M.version,a=X,l=a[((0,c.indexOf)(a,t)-1)%a.length];var r={};r.version=l,r.id=M.id,r.isChangeVersion=!0,K(r)})(e)}),l.createElement("span",null,"Version ".concat(M&&M.version)),l.createElement("i",{className:(0,c.isUndefined)(X[(0,c.indexOf)(X,M&&M.version)+1])?"fa-fw fa fa-chevron-right":"fa-fw fa fa-chevron-right active",onClick:e=>e.currentTarget.classList.contains("active")&&(e=>{if(e.currentTarget.classList.contains("active"))var t=M&&M.version,a=X,l=a[((0,c.indexOf)(a,t)+1)%a.length];var r={};r.version=l,r.id=M.id,r.isChangeVersion=!0,K(r)})(e)})),!(0,c.isUndefined)(X[(0,c.indexOf)(X,M&&M.version)+1])&&l.createElement(d.A,{variant:"primary",size:"sm",onClick:e=>(e=>{e.preventDefault();var t=M&&M.version,a={};a.version=t,a.id=M.id,a.isRevert=!0,K(a),U(!1)})(e)},"Revert")),l.createElement(d.A,{variant:"primary",size:"sm",onClick:Le},"OK")))))};var j=a(1461),L=a(4062),T=a(6005),I=a(2431);const H=e=>{var{serviceData:t,serviceDefData:a}=e;return l.createElement(m.A,null,l.createElement(p.A,{sm:12},l.createElement("p",{className:"form-header"},"Service Details :"),l.createElement("div",{className:"overflow-auto"},l.createElement(I.A,{bordered:!0,size:"sm"},l.createElement("tbody",{className:"service-details"},l.createElement("tr",null,l.createElement("td",{className:"text-nowrap"},"Service Name"),l.createElement("td",{className:"text-break"},null==t?void 0:t.name)),l.createElement("tr",null,l.createElement("td",{className:"text-nowrap"},"Display Name"),l.createElement("td",{className:"text-break"},null==t?void 0:t.displayName)),l.createElement("tr",null,l.createElement("td",{className:"text-nowrap"},"Description"),l.createElement("td",{className:"text-break"},null!=t&&t.description?t.description:"--")),l.createElement("tr",null,l.createElement("td",null,"Active Status"),l.createElement("td",null,l.createElement("h6",null,l.createElement(s.A,{bg:"info"},null!=t&&t.isEnabled?"Enabled":"Disabled")))),l.createElement("tr",null,l.createElement("td",{className:"text-nowrap"},"Tag Service"),l.createElement("td",{className:"text-break"},null!=t&&t.tagService?l.createElement("h6",null,l.createElement(s.A,{bg:"info"},t.tagService)):"--"))))),l.createElement("p",{className:"form-header"},"Config Properties :"),l.createElement("div",{className:"table-responsive"},l.createElement(I.A,{bordered:!0,size:"sm"},l.createElement("tbody",{className:"service-config"},((e,t)=>{var a,r,n,i=[],o={},s={},d=null==e||null===(a=e.configs)||void 0===a?void 0:a.filter((e=>"ranger.plugin.audit.filters"!==e.name));t=(0,c.omit)(t,"ranger.plugin.audit.filters");var u=(0,c.keys)(t),m=(0,c.map)(d,"name"),p=(0,c.intersection)((0,c.map)(D.md,"name"),u),v=(0,c.sortBy)((0,c.difference)((0,c.difference)(u,m),p));return null==d||d.map((e=>o[void 0!==e.label?e.label:e.name]=t[e.name])),p.map((e=>{o[(0,c.find)(D.md,["name",e]).label]=t[e]})),null===(r=Object.entries(o))||void 0===r||r.map((e=>{var[t,a]=e;return i.push(l.createElement("tr",{key:t},l.createElement("td",null,t),l.createElement("td",null,a||"--")))})),v.map((e=>s[e]=t[e])),i.push(l.createElement("tr",{key:"custom-configs-title"},l.createElement("td",{colSpan:"2"},l.createElement("b",null,"Custom Configurations :")))),(0,c.isEmpty)(s)&&i.push(l.createElement("tr",{key:"custom-configs-empty"},l.createElement("td",null,"--"),l.createElement("td",null,"--"))),null===(n=Object.entries(s))||void 0===n||n.map((e=>{var[t,a]=e;return i.push(l.createElement("tr",{key:t},l.createElement("td",null,t),l.createElement("td",null,a||"--")))})),i})(a,t.configs)))),l.createElement("p",{className:"form-header"},"Audit Filter :"),l.createElement("div",{className:"table-responsive"},l.createElement(I.A,{bordered:!0,size:"sm",className:"table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Is Audited"),l.createElement("th",null,"Access Result"),l.createElement("th",null,"Resources"),l.createElement("th",null,"Operations"),l.createElement("th",null,"Permissions"),l.createElement("th",null,"Users"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Roles"))),l.createElement("tbody",null,(e=>{var t,a=[],r=(0,c.pick)(e,"ranger.plugin.audit.filters");if((0,c.isEmpty)(r))return a;if((0,c.isEmpty)(r["ranger.plugin.audit.filters"]))return a;try{r=JSON.parse(r["ranger.plugin.audit.filters"].replace(/'/g,'"'))}catch(e){return a.push(l.createElement("tr",{key:"error-service-audit-filter"},l.createElement("td",{className:"text-center",colSpan:"8"},l.createElement(u.A,{variant:"danger"},"Error occured while parsing service audit filter!")))),a}return null===(t=r)||void 0===t||t.map(((e,t)=>{return a.push(l.createElement("tr",{key:t},l.createElement("td",{className:"text-center"},1==e.isAudited?l.createElement("h6",null,l.createElement(s.A,{bg:"info"},"Yes")):l.createElement("h6",null,l.createElement(s.A,{bg:"info"},"No"))),l.createElement("td",{className:"text-center"},void 0!==e.accessResult?l.createElement("h6",null,l.createElement(s.A,{bg:"info"},e.accessResult)):"--"),l.createElement("td",{className:"text-center"},void 0!==e.resources?l.createElement("div",{className:"resource-grp"},(r=e.resources,Object.keys(r).map(((e,t)=>{var a=r[e].values;return l.createElement("div",{key:t,className:"clearfix mb-2"},l.createElement("span",{className:"float-start"},l.createElement("b",null,e,": "),a.join()),void 0!==r[e].isExcludes?l.createElement("h6",{className:"d-inline"},r[e].isExcludes?l.createElement("span",{className:"badge bg-dark float-end"},"Exclude"):l.createElement("span",{className:"badge bg-dark float-end"},"Include")):"",void 0!==r[e].isRecursive?l.createElement("h6",{className:"d-inline"},r[e].isRecursive?l.createElement("span",{className:"badge bg-dark float-end"},"Recursive"):l.createElement("span",{className:"badge bg-dark float-end"},"Non Recursive")):"")})))):"--"),l.createElement("td",{className:"text-center"},void 0!==e.actions?e.actions.map((e=>l.createElement(s.A,{bg:"info",className:"m-1 text-truncate",key:e},e))):"--"),l.createElement("td",{className:"text-center"},void 0!==e.accessTypes&&e.accessTypes.length>0?e.accessTypes.map((e=>l.createElement(s.A,{bg:"info",className:"m-1 text-truncate",key:e},e))):"--"),l.createElement("td",{className:"text-center"},void 0!==e.users?e.users.map((e=>l.createElement(s.A,{bg:"info",className:"m-1 text-truncate more-less-width",title:e,key:e},e))):"--"),l.createElement("td",{className:"text-center"},void 0!==e.groups?e.groups.map((e=>l.createElement(s.A,{bg:"info",className:"m-1 text-truncate more-less-width",title:e,key:e},e))):"--"),l.createElement("td",{className:"text-center"},void 0!==e.roles?e.roles.map((e=>l.createElement(s.A,{bg:"info",key:e},e))):"--")));var r})),a})(t.configs))))))};function R(e,t,a,l,r,n,i){try{var c=e[n](i),o=c.value}catch(e){return void a(e)}c.done?t(o):Promise.resolve(o).then(l,r)}function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(Object(a),!0).forEach((function(t){V(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function V(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _(e,t){switch(t.type){case"SHOW_VIEW_MODAL":return B(B({},e),{},{showView:t.showView});case"SHOW_DELETE_MODAL":return B(B({},e),{},{showDelete:t.showDelete});default:throw new Error}}const Z=e=>{var t,a,n,i=(0,h.Xm)()||(0,h.EH)(),o=(0,h.QY)(),s=(0,h.FV)()||(0,h.Xm)(),u=(0,r.Zp)(),[m,p]=(0,l.useReducer)(_,{showView:null,showDelete:!1}),{showView:f,showDelete:b}=m,{serviceDefData:w,serviceData:N,handleServiceChange:S,getServices:D,allServicesData:A,policyLoader:O,currentServiceZone:x,handleZoneChange:P,getZones:k,allZonesData:C}=e,I={option:(e,t)=>B(B({},e),{},{color:t.isSelected?"white":"black"}),control:e=>B(B({},e),{},{maxHeight:"32px",minHeight:"32px"}),indicatorsContainer:e=>B(B({},e),{},{maxHeight:"30px"}),dropdownIndicator:e=>B(B({},e),{},{padding:"5px"}),clearIndicator:e=>B(B({},e),{},{padding:"5px"}),container:e=>B(B({},e),{},{width:"240px"})},z=e=>B(B({},e),{},{colors:B(B({},e.colors),{},{primary:"#0081ab"})}),V=()=>{p({type:"SHOW_VIEW_MODAL",showView:null})},Z=()=>{p({type:"SHOW_DELETE_MODAL",showDelete:!1})},F=function(){var e,t=(e=function*(e){Z();try{yield(0,g.fetchApi)({url:"plugins/services/".concat(e),method:"delete"}),E.oR.success("Successfully deleted the service"),u("tag"===(null==w?void 0:w.name)?"/policymanager/tag":"/policymanager/resource")}catch(e){(0,h.ig)(e),console.error("Error occurred while deleting Service id - ".concat(null==N?void 0:N.id,"!  ").concat(e))}},function(){var t=this,a=arguments;return new Promise((function(l,r){var n=e.apply(t,a);function i(e){R(n,l,r,i,c,"next",e)}function c(e){R(n,l,r,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),W=e=>{var{label:t}=e;return l.createElement("div",{title:t,className:"text-truncate"},t)};return l.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light content-top-nav"},l.createElement("div",{className:"top-nav-title-wrapper"},l.createElement("span",{className:"top-nav-title"},"".concat((0,c.upperCase)(null==w?void 0:w.name)," Policies")),l.createElement("span",{className:"pipe show-on-mobile"}),l.createElement(T.Ay,{theme:z,styles:I,className:"".concat(O?"not-allowed":""),isDisabled:!!O,options:D(A),formatOptionLabel:W,onChange:e=>S(e),value:O?"":(n=N,(0,c.isEmpty)(n)?"":{label:"Service : ".concat(null==n?void 0:n.displayName),value:n.displayName}),menuPlacement:"auto",placeholder:"Select Service Name",hideSelectedOptions:!0}),!i&&l.createElement(l.Fragment,null,l.createElement("span",{className:"pipe show-on-mobile"}),l.createElement(T.Ay,{theme:z,styles:I,className:"".concat(O?"not-allowed":""),isDisabled:!!O,options:k(C),onChange:e=>P(e),value:O?"":(a=x,null!==a?{label:"Security Zone : ".concat(null==a?void 0:a.label),value:a.value}:""),formatOptionLabel:W,menuPlacement:"auto",placeholder:"Select Zone Name",isClearable:!0,hideSelectedOptions:!0}))),l.createElement("div",{className:"collapse navbar-collapse justify-content-end",id:"navbarText"},(!o||s)&&l.createElement(j.A,{id:"dropdown-item-button",title:"Manage Service",size:"sm",className:"manage-service",disabled:!!O},!o&&l.createElement(L.A.Item,{as:"button",className:"".concat(O?"not-allowed":""),onClick:()=>{var e;e=null==N?void 0:N.id,p({type:"SHOW_VIEW_MODAL",showView:e})},disabled:!!O,"data-name":"viewService","data-id":null==N?void 0:N.id,"data-cy":null==N?void 0:N.id},l.createElement("i",{className:"fa-fw fa fa-eye fa-fw fa fa-large"})," View Service"),s&&l.createElement(L.A.Item,{as:"button",disabled:!!O,className:"".concat(O?"not-allowed text-decoration-none":"text-decoration-none"),state:null===(t=A[0])||void 0===t?void 0:t.id,onClick:()=>{u("/service/".concat(w.id,"/edit/").concat(null==N?void 0:N.id))},"data-name":"editService","data-id":null==N?void 0:N.id,"data-cy":null==N?void 0:N.id},l.createElement("i",{className:"fa-fw fa fa-edit fa-fw fa fa-large"})," Edit Service"),s&&l.createElement(L.A.Item,{as:"button",disabled:!!O,className:"".concat(O?"not-allowed":""),onClick:()=>{p({type:"SHOW_DELETE_MODAL",showDelete:!0})},"data-name":"deleteService","data-id":null==N?void 0:N.id,"data-cy":null==N?void 0:N.id},l.createElement("i",{className:"fa-fw fa fa-trash fa-fw fa fa-large"})," Delete Service")),(!o||s)&&l.createElement("span",{className:"pipe"}),l.createElement("span",{className:"navbar-text last-response-time"},l.createElement("strong",null,"Last Response Time"),l.createElement("br",null),y()(y()()).format("MM/DD/YYYY hh:mm:ss A"))),l.createElement(v.A,{show:f===(null==N?void 0:N.id),onHide:V,size:"xl"},l.createElement(v.A.Header,{closeButton:!0},l.createElement(v.A.Title,null,"Service Details")),l.createElement(v.A.Body,null,l.createElement(H,{serviceDefData:w,serviceData:N})),l.createElement(v.A.Footer,null,l.createElement(d.A,{variant:"primary",size:"sm",onClick:V},"OK"))),l.createElement(v.A,{show:b,onHide:Z},l.createElement(v.A.Header,{closeButton:!0},l.createElement("span",{className:"text-word-break"},'Are you sure want to delete service "',l.createElement("b",null,"".concat(null==N?void 0:N.displayName)),'" ?')),l.createElement(v.A.Footer,null,l.createElement(d.A,{variant:"secondary",size:"sm",title:"Cancel",onClick:Z},"Cancel"),l.createElement(d.A,{variant:"primary",size:"sm",title:"Yes",onClick:()=>F(null==N?void 0:N.id)},"Yes"))))};var F=a(4283);function W(e,t,a,l,r,n,i){try{var c=e[n](i),o=c.value}catch(e){return void a(e)}c.done?t(o):Promise.resolve(o).then(l,r)}function J(e){return function(){var t=this,a=arguments;return new Promise((function(l,r){var n=e.apply(t,a);function i(e){W(n,l,r,i,c,"next",e)}function c(e){W(n,l,r,i,c,"throw",e)}i(void 0)}))}}function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(Object(a),!0).forEach((function(t){K(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function K(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Y(e,t){switch(t.type){case"SET_LOADER":return M(M({},e),{},{loader:t.loader});case"SERVICES_DATA":return M(M({},e),{},{serviceDefData:t.serviceDefData,serviceData:t.serviceData,allServicesData:t.allServicesData});default:throw new Error}}var G=()=>{var e,t=(0,h.Xm)()||(0,h.EH)(),a=(0,c.cloneDeep)((0,F.Ji)()),o=(0,r.Zp)(),s=(0,r.g)(),[d,u]=(0,l.useReducer)(Y,{loader:!0,serviceData:{},serviceDefData:{},allServicesData:[]}),{loader:m,serviceDefData:p,serviceData:v,allServicesData:f}=d,[y,E]=(0,l.useState)([]),b=localStorage.getItem("zoneDetails");(0,l.useEffect)((()=>{N()}),[null==s?void 0:s.serviceId,null==s?void 0:s.policyType,null===(e=JSON.parse(b))||void 0===e?void 0:e.value]);var N=function(){var e=J((function*(){var e,l,r,n,i,o,d,m,p,v,f,y,b,w;null===(e=document.getElementById("resourceSelectedZone"))||void 0===e||null===(l=e.classList)||void 0===l||l.add("disabledEvents"),null===(r=document.getElementById("tagSelectedZone"))||void 0===r||null===(n=r.classList)||void 0===n||n.add("disabledEvents"),u({type:"SET_LOADER",loader:!0});var N,S={},D=[],A={},O=[];try{var x,P,k,C;S=yield(0,g.fetchApi)({url:"plugins/services/".concat(s.serviceId)}),D=yield(0,g.fetchApi)({url:"plugins/services?serviceType=".concat(null===(x=S)||void 0===x||null===(P=x.data)||void 0===P?void 0:P.type)}),A=null==a||null===(k=a.allServiceDefs)||void 0===k?void 0:k.find((e=>{var t,a;return e.name==(null===(t=S)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.type)})),t||(O=yield(0,g.fetchApi)({url:"public/v2/api/zones/zone-headers/for-service/".concat(s.serviceId),params:{isTagService:"tag"==(null===(C=S.data)||void 0===C?void 0:C.type)}}))}catch(e){console.error("Error occurred while fetching service details ! ".concat(e))}N=void 0!==(null===(i=A)||void 0===i?void 0:i.name)&&"tag"===(null===(o=A)||void 0===o?void 0:o.name),(0,h.eb)(N),E((null===(d=O)||void 0===d?void 0:d.data)||[]),u({type:"SERVICES_DATA",allServicesData:null===(m=D)||void 0===m||null===(p=m.data)||void 0===p?void 0:p.services,serviceData:null===(v=S)||void 0===v?void 0:v.data,serviceDefData:A}),(0,c.isEmpty)(S)||(0,c.isEmpty)(A)||u({type:"SET_LOADER",loader:!1}),null===(f=document.getElementById("resourceSelectedZone"))||void 0===f||null===(y=f.classList)||void 0===y||y.remove("disabledEvents"),null===(b=document.getElementById("tagSelectedZone"))||void 0===b||null===(w=b.classList)||void 0===w||w.remove("disabledEvents")}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=J((function*(e){if(""!==e){var t=null==f?void 0:f.find((t=>{if(t.displayName==(null==e?void 0:e.label))return t}));o("/service/".concat(null==t?void 0:t.id,"/policies/").concat(s.policyType)),localStorage.removeItem("zoneDetails")}}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=J((function*(e){if(e&&void 0!==e){var t={};t.label=e.label,t.value=e.value,localStorage.setItem("zoneDetails",JSON.stringify(t))}else localStorage.removeItem("zoneDetails");o("/service/".concat(s.serviceId,"/policies/").concat(s.policyType))}));return function(t){return e.apply(this,arguments)}}(),A=()=>{var e=null;if(null!=b)for(var t of y){var a;if(t.name===(null===(a=JSON.parse(b))||void 0===a?void 0:a.label)){e={label:t.name,value:t.id};break}}return e};return l.createElement(l.Fragment,null,l.createElement(Z,{serviceDefData:p,serviceData:v,handleServiceChange:S,getServices:e=>(0,c.sortBy)((0,c.map)(e,(function(e){var{displayName:t}=e;return{label:t,value:t}})),"label"),allServicesData:(0,c.sortBy)(f,"name"),policyLoader:m,currentServiceZone:A(),handleZoneChange:D,getZones:e=>(0,c.sortBy)((0,c.map)(e,(function(e){return{label:e.name,value:e.id}})),"label"),allZonesData:y}),m?l.createElement(w.aH,null):((0,h.f0)(p.dataMaskDef)||(0,h.DN)(p.rowFilterDef))&&s.policyType<3?l.createElement(n.A,{id:"PolicyListing",activeKey:s.policyType,onSelect:e=>{return t=e,void o("/service/".concat(null==s?void 0:s.serviceId,"/policies/").concat(t));var t}},l.createElement(i.A,{eventKey:"0",title:"Access"},"0"==s.policyType&&l.createElement(C,{serviceDef:p,serviceData:v,serviceZone:A()})),(0,h.f0)(null==p?void 0:p.dataMaskDef)&&l.createElement(i.A,{eventKey:"1",title:"Masking"},"1"==s.policyType&&l.createElement(C,{serviceDef:p,serviceData:v,serviceZone:A()})),(0,h.DN)(p.rowFilterDef)&&l.createElement(i.A,{eventKey:"2",title:"Row Level Filter"},"2"==s.policyType&&l.createElement(C,{serviceDef:p,serviceData:v,serviceZone:A()}))):l.createElement(C,{serviceDef:p,serviceData:v,serviceZone:A()}))};const X=G},9528:(e,t,a)=>{a.d(t,{Tj:()=>r,jJ:()=>n,mf:()=>i});var l=a(6540);function r(e,t){let a=0;return l.Children.map(e,(e=>l.isValidElement(e)?t(e,a++):e))}function n(e,t){let a=0;l.Children.forEach(e,(e=>{l.isValidElement(e)&&t(e,a++)}))}function i(e,t){return l.Children.toArray(e).some((e=>l.isValidElement(e)&&e.type===t))}},9567:(e,t,a)=>{a.d(t,{A:()=>y}),a(6540);var l=a(1558),r=a(1597),n=a(5265),i=a(3558),c=a(4501),o=a(7867),s=a(2014),d=a(9528),u=a(4268),m=a(4848);function p(e){let t;return(0,d.jJ)(e,(e=>{null==t&&(t=e.props.eventKey)})),t}function v(e){const{title:t,eventKey:a,disabled:l,tabClassName:r,tabAttrs:n,id:o}=e.props;return null==t?null:(0,m.jsx)(c.A,{as:"li",role:"presentation",children:(0,m.jsx)(i.A,{as:"button",type:"button",eventKey:a,disabled:l,id:o,className:r,...n,children:t})})}const f=e=>{const{id:t,onSelect:a,transition:i,mountOnEnter:c=!1,unmountOnExit:f=!1,variant:y="tabs",children:E,activeKey:g=p(E),...b}=(0,l.Zw)(e,{activeKey:"onSelect"});return(0,m.jsxs)(r.A,{id:t,activeKey:g,onSelect:a,transition:(0,u.A)(i),mountOnEnter:c,unmountOnExit:f,children:[(0,m.jsx)(n.A,{...b,role:"tablist",as:"ul",variant:y,children:(0,d.Tj)(E,v)}),(0,m.jsx)(o.A,{children:(0,d.Tj)(E,(e=>{const t={...e.props};return delete t.title,delete t.disabled,delete t.tabClassName,delete t.tabAttrs,(0,m.jsx)(s.A,{...t})}))})]})};f.displayName="Tabs";const y=f}}]);