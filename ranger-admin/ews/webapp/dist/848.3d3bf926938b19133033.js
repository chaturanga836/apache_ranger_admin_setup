"use strict";(self.webpackChunkranger=self.webpackChunkranger||[]).push([[848],{2885:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(6540),r=a(8106);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l.apply(this,arguments)}const i=e=>t=>{var a=(0,r.zy)(),i=(0,r.Zp)(),n=(0,r.g)();return s.createElement(e,l({navigate:i,location:a,params:n},t))}},6848:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$});var s=a(6540),r=a(5615),l=a(4479),i=a(1105),n=a(6005),c=a(6474),o=a(2543),m=a(3267),d=a(3666),p=a(2885),u=a(8651),h=a(2735),v=a(6052),f=a(2431),E=a(2465),b=a(1376),y=a(5787);function g(e,t,a,s,r,l,i){try{var n=e[l](i),c=n.value}catch(e){return void a(e)}n.done?t(c):Promise.resolve(c).then(s,r)}function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){N(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function N(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class A extends s.Component{constructor(e){var t;super(e),t=this,N(this,"Theme",(e=>w(w({},e),{},{colors:w(w({},e.colors),{},{text:"#444444",primary25:"#0b7fad;",primary:"#0b7fad;"})}))),N(this,"downloadFile",(e=>{var{responseData:t}=e,a=t.config.params.serviceName,s=t.config.params.zoneName,r=(0,d.$_)()+"service/plugins/policies/exportJson?serviceName="+a+"&checkPoliciesExists=false"+(void 0!==s?"&zoneName="+s:""),l=document.createElement("a");l.href=r;var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});document.body.appendChild(l),l.dispatchEvent(i),l.remove()})),N(this,"handleServiceChange",(e=>{this.setState({selectedServices:e})})),N(this,"handleServiceDefChange",(e=>{var t=e.map((e=>this.props.services.filter((t=>t.type===e.value)))).flat().map((e=>({value:e.name,label:e.displayName})));this.setState({selectedServices:t,serviceOptions:t})})),N(this,"export",function(){var e,a=(e=function*(e){var a;e.preventDefault();var s=(0,o.toString)((0,o.map)(t.state.selectedServices,"value")),r={};r.serviceName=s,r.checkPoliciesExists=!0,t.props.zone&&(r.zoneName=t.props.zone);try{t.props.onHide(),t.props.showBlockUI(!0,a),200===(a=yield(0,m.fetchApi)({url:"/plugins/policies/exportJson",params:w({},r)})).status?t.downloadFile({responseData:a}):c.oR.warning("No policies found to export"),t.props.showBlockUI(!1,a)}catch(e){t.props.showBlockUI(!1,null==e?void 0:e.response),(0,d.ig)(e),console.error("Error occurred while exporting policies ".concat(e))}},function(){var t=this,a=arguments;return new Promise((function(s,r){var l=e.apply(t,a);function i(e){g(l,s,r,i,n,"next",e)}function n(e){g(l,s,r,i,n,"throw",e)}i(void 0)}))});return function(e){return a.apply(this,arguments)}}()),this.serviceDefOptions=this.props.serviceDef.map((e=>({value:e.name,label:e.displayName}))),this.serviceOptions=this.props.services.map((e=>({value:e.name,label:e.displayName}))),this.state={isParentExport:this.props.isParentExport,selectedServices:this.serviceOptions,serviceOptions:this.serviceOptions}}render(){var{isParentExport:e,serviceOptions:t,selectedServices:a}=this.state;return s.createElement(s.Fragment,null,s.createElement(E.A,{show:this.props.show,onHide:this.props.onHide,size:(0,o.isEmpty)(this.props.services)?"md":"lg"},s.createElement(E.A.Header,{closeButton:!0},s.createElement(E.A.Title,null,(0,o.isEmpty)(this.props.services)?s.createElement("h6",null,"No service found to export policies."):"Export Policy")),!(0,o.isEmpty)(this.props.services)&&s.createElement(E.A.Body,null,e&&s.createElement("div",{className:"mb-3"},s.createElement("h6",{className:"bold"},"Service Type *"),s.createElement(n.Ay,{isMulti:!0,onChange:this.handleServiceDefChange,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null},isClearable:!1,theme:this.Theme,options:this.serviceDefOptions,defaultValue:this.serviceDefOptions,menuPlacement:"auto",placeholder:"Select Service Type",styles:y.eB})),s.createElement("div",{className:"mt-2"},s.createElement("h6",{className:"bold"},"Select Service Name *"),s.createElement(n.Ay,{isMulti:!0,onChange:this.handleServiceChange,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null},isClearable:!1,theme:this.Theme,options:t,defaultValue:this.serviceOptions,value:a,menuPlacement:"auto",placeholder:"Select Service Name",styles:y.eB}))),s.createElement(E.A.Footer,null,(0,o.isEmpty)(this.props.services)?s.createElement(r.A,{variant:"primary",className:"btn-sm",onClick:this.props.onHide},"OK"):s.createElement(s.Fragment,null,s.createElement(r.A,{variant:"secondary",className:"btn-sm",onClick:this.props.onHide},"Cancel"),s.createElement(r.A,{variant:"primary",className:"btn-sm",onClick:this.export,disabled:(0,o.isEmpty)(this.state.selectedServices)},"Export")))))}}const O=A;var D=a(952),k=a(3088),x=a(924);function F(){return F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},F.apply(this,arguments)}function I(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?I(Object(a),!0).forEach((function(t){T(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function C(e,t,a,s,r,l,i){try{var n=e[l](i),c=n.value}catch(e){return void a(e)}n.done?t(c):Promise.resolve(c).then(s,r)}function M(e){return function(){var t=this,a=arguments;return new Promise((function(s,r){var l=e.apply(t,a);function i(e){C(l,s,r,i,n,"next",e)}function n(e){C(l,s,r,i,n,"throw",e)}i(void 0)}))}}function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class j extends s.Component{constructor(e){var t;super(e),t=this,T(this,"removeFile",(()=>{this.setState({fileName:null,fileJsonData:null,fileNotJson:!1,sourceServicesMap:null})})),T(this,"handleFileUpload",((e,t)=>{e.preventDefault();var a=new FileReader;if(a.readAsText(e.target.files[0]),e.target&&e.target.files.length>0){var s=e.target.files[0],r=e.target.files[0].name;"json"===(0,o.split)(r,".").pop()?(this.setState({fileName:r,file:s}),a.onload=e=>{var a,s=JSON.parse(e.target.result),r=(0,o.groupBy)(s.policies,(function(e){return e.service}));(0,o.has)(s,"policies")&&s.policies.length>0&&(a=s.policies[0].zoneName);var l=Object.keys(r).map((e=>this.props.isParentImport?{sourceServiceName:{value:e,label:e},destServiceName:{value:e,label:e}}:{sourceServiceName:{value:e,label:e},destServiceName:void 0!==(0,o.find)(this.props.services,{name:e,type:this.props.serviceDef.name})?{value:e,label:e}:void 0})),i={};i.serviceFields=l,i.sourceZoneName=a,i.isOverride=t.isOverride,this.setState({fileJsonData:s,sourceServicesMap:r,destServices:this.props.isParentImport?this.props.allServices:this.props.services,sourceZoneName:a,initialFormFields:i,filterFormFields:i})}):this.setState({fileName:r,fileNotJson:!0})}})),T(this,"importJsonFile",function(){var e=M((function*(e){var a,s,r={},l={},i=new FormData;(0,o.map)(e.serviceFields,(function(e){return void 0!==e&&(r[e.sourceServiceName.value]=e.destServiceName.value)})),l[e.sourceZoneName]=t.state.destZoneName,i.append("file",t.state.file),i.append("servicesMapJson",new Blob([JSON.stringify(r)],{type:"application/json"})),i.append("zoneMapJson",new Blob([JSON.stringify(l)],{type:"application/json"})),a=t.props.isParentImport?(0,o.toString)((0,o.uniq)((0,o.map)(t.props.services,"type"))):t.props.serviceDef.name;try{t.props.onHide(),t.props.showBlockUI(!0,s),s=yield(0,m.fetchApi)({url:"/plugins/policies/importPoliciesFromFile",params:{serviceType:a,isOverride:e.isOverride},method:"post",data:i}),t.props.showBlockUI(!1,s),c.oR.success("Successfully imported the file")}catch(e){t.props.showBlockUI(!1,null==e?void 0:e.response),(0,d.ig)(e),console.error("Error occurred while importing policies! ".concat(e))}}));return function(t){return e.apply(this,arguments)}}()),T(this,"handleSelectedZone",function(){var e=M((function*(e,a){var s={},r=[];try{if(e&&void 0!==e){r=yield(0,m.fetchApi)({url:"public/v2/api/zones/".concat(e&&e.value,"/service-headers")});var l=(0,o.map)(r.data,"name").map((e=>t.props.allServices.filter((t=>t.name===e))));l=l.flat();var i=Object.keys(t.state.sourceServicesMap).map((e=>({sourceServiceName:{value:e,label:e},destServiceName:void 0!==(0,o.find)(l,{name:e})?{value:e,label:e}:void 0})));s.serviceFields=i,s.sourceZoneName=t.state.initialFormFields.sourceZoneName,s.isOverride=a.isOverride,t.setState({destZoneName:e&&e.label,destServices:l,filterFormFields:s})}else s.serviceFields=t.state.initialFormFields.serviceFields,s.sourceZoneName=t.state.initialFormFields.sourceZoneName,s.isOverride=a.isOverride,t.setState({destZoneName:"",destServices:t.props.isParentImport?t.props.allServices:t.props.services,filterFormFields:s})}catch(e){(0,d.ig)(e),console.error("Error occurred while fetching Services from selected Zone! ".concat(e))}}));return function(t,a){return e.apply(this,arguments)}}()),T(this,"getSourceServiceOptions",(()=>Object.keys(this.state.sourceServicesMap).map((e=>({value:e,label:e}))))),T(this,"getDestServiceOptions",(()=>this.state.destServices.map((e=>({value:e.name,label:e.name}))))),T(this,"Theme",(e=>P(P({},e),{},{colors:P(P({},e.colors),{},{primary:"#0081ab"})}))),T(this,"CustomStyles",P(P({},y.eB),{},{option:(e,t)=>P(P({},e),{},{color:t.isSelected?"white":"black"})})),T(this,"requiredField",(e=>e?void 0:"Please select/enter service name")),T(this,"requiredFieldArray",(e=>{e&&e.length>0&&e.map((e=>e.sourceServiceName!==e.destServiceName?"Source service name should not be same.":""))})),this.state={file:null,fileName:null,fileJsonData:null,sourceServicesMap:null,destServices:null,sourceZoneName:"",destZoneName:"",initialFormFields:{isOverride:!1},filterFormFields:{},fileNotJson:!1}}render(){return s.createElement(s.Fragment,null,s.createElement(E.A,{show:this.props.show,onHide:this.props.onHide,size:(0,o.isEmpty)(this.props.services)?"md":"lg"},s.createElement(D.lV,{onSubmit:this.importJsonFile,mutators:P({},x.A),initialValues:this.state.filterFormFields,render:e=>{var{handleSubmit:t,values:a,form:{mutators:{push:c}}}=e;return s.createElement("form",{onSubmit:t},s.createElement(E.A.Header,{closeButton:!0},s.createElement(E.A.Title,null,(0,o.isEmpty)(this.props.services)?s.createElement("small",null,"No service found to import policies."):(0,o.isEmpty)(this.props.selectedZone)?"Import Policy":"Import Policy For Zone")),!(0,o.isEmpty)(this.props.services)&&s.createElement(E.A.Body,null,s.createElement(s.Fragment,null,s.createElement(l.A,null,s.createElement(l.A,{sm:12},s.createElement(i.A,{sm:7},s.createElement(D.D0,{name:"uploadPolicyFile"},(e=>{var{input:t}=e;return s.createElement("div",{className:"form-group col-sm-6"},s.createElement("label",{className:"btn btn-sm border"},"Select File :",s.createElement("i",{className:"fa-fw fa fa-arrow-circle-o-up"}),s.createElement("input",F({},t,{style:{display:"none"},type:"file",className:"form-control-file",accept:" .json ",onChange:e=>this.handleFileUpload(e,a)}))))}))),s.createElement(i.A,{sm:5},s.createElement("div",{className:"form-check"},s.createElement(D.D0,{name:"isOverride",component:"input",type:"checkbox",className:"form-check-input"}),s.createElement("label",{className:"form-check-label"},"Override Policy")))),s.createElement(i.A,{sm:12},this.state.fileName?s.createElement("span",null,this.state.fileName,s.createElement("label",{className:"fa fa-fw fa-remove fa-remove-btn",onClick:()=>{this.removeFile()}})):s.createElement("span",{className:"ms-1"},"No File Chosen")),s.createElement(i.A,{sm:12},this.state.fileName&&this.state.fileNotJson&&s.createElement("span",{className:"invalid-field"},"Please upload json format file"))),this.state.fileJsonData&&!(0,o.isEmpty)(this.state.sourceServicesMap)&&s.createElement(s.Fragment,null,s.createElement("hr",null),s.createElement(l.A,null,s.createElement(i.A,{sm:12},s.createElement(h.A,{variant:"warning",show:!0},s.createElement("i",{className:"fa-fw fa fa-info-circle searchInfo m-r-xs"}),"All services gets listed on service destination when Zone destination is blank. When zone is selected at destination, then only services associated with that zone will be listed."))),s.createElement(l.A,null,s.createElement(i.A,{sm:12},s.createElement("p",{className:"fw-bold"},"Specify Zone Mapping :"))),s.createElement(l.A,{className:"mt-3"},s.createElement(i.A,{sm:4},s.createElement("div",{className:"col text-center"},"Source")),s.createElement(i.A,{sm:4},s.createElement("div",{className:"col text-center"},"Destination"))),s.createElement(l.A,{className:"mt-3"},s.createElement(i.A,{sm:4},s.createElement(D.D0,{name:"sourceZoneName"},(e=>{var{input:t}=e;return s.createElement("input",F({},t,{type:"text",className:"form-control",disabled:!0}))}))),s.createElement(i.A,{sm:1},"To"),s.createElement(i.A,{sm:4},s.createElement(n.Ay,{onChange:e=>this.handleSelectedZone(e,a),isClearable:!0,components:{IndicatorSeparator:()=>null},theme:this.Theme,styles:this.CustomStyles,options:this.props.zones.map((e=>({value:e.id,label:e.name}))),placeholder:"No zone selected"}))),s.createElement("hr",null),s.createElement(l.A,null,s.createElement(i.A,{sm:12},s.createElement("p",{className:"fw-bold"},"Specify Service Mapping :"))),s.createElement(l.A,null,s.createElement(i.A,{sm:4},s.createElement("div",{className:"col text-center"},"Source")),s.createElement(i.A,{sm:4},s.createElement("div",{className:"col text-center"},"Destination"))),s.createElement(k.ED,{name:"serviceFields"},(e=>{var{fields:t}=e;return t.map(((e,a)=>s.createElement(l.A,{className:"mt-2",key:e},s.createElement(i.A,{sm:4},s.createElement(D.D0,{name:"".concat(e,".sourceServiceName"),validate:this.requiredField},(e=>{var{input:t,meta:a}=e;return s.createElement(s.Fragment,null,s.createElement(n.Ay,F({},t,{searchable:!0,isClearable:!0,options:this.getSourceServiceOptions(),menuPlacement:"auto",placeholder:"Enter service name",theme:this.Theme,styles:this.CustomStyles})),a.error&&a.touched&&s.createElement("span",{className:"invalid-field"},a.error))}))),s.createElement(i.A,{sm:1},"To"),s.createElement(i.A,{sm:4},s.createElement(D.D0,{name:"".concat(e,".destServiceName"),validate:this.requiredField},(e=>{var{input:t,meta:a}=e;return s.createElement(s.Fragment,null,s.createElement(n.Ay,F({},t,{searchable:!0,isClearable:!0,options:this.getDestServiceOptions(),menuPlacement:"auto",placeholder:"Select service name",theme:this.Theme,styles:this.CustomStyles})),a.error&&a.touched&&s.createElement("span",{className:"invalid-field"},a.error))}))),s.createElement(i.A,{sm:1},s.createElement(r.A,{className:"mt-1",variant:"danger",size:"sm",title:"Remove",onClick:()=>t.remove(a)},s.createElement("i",{className:"fa-fw fa fa-remove"}))))))})),s.createElement(l.A,{className:"mt-3"},s.createElement(i.A,{sm:2},s.createElement(r.A,{variant:"outline-dark",size:"sm",onClick:()=>c("serviceFields",void 0)},s.createElement("i",{className:"fa-fw fa fa-plus"}))))),this.state.fileJsonData&&(0,o.isEmpty)(this.state.sourceServicesMap)&&s.createElement(s.Fragment,null,s.createElement("p",{className:"invalid-field mt-2"},"Json file uploaded is invalid.")))),s.createElement(E.A.Footer,null,(0,o.isEmpty)(this.props.services)?s.createElement(r.A,{variant:"primary",size:"sm",onClick:this.props.onHide},"OK"):s.createElement(s.Fragment,null,s.createElement(r.A,{variant:"secondary",size:"sm",onClick:this.props.onHide},"Cancel"),s.createElement(r.A,{variant:"primary",type:"submit",size:"sm",disabled:(0,o.isEmpty)(this.state.sourceServicesMap)},"Import"))))}})))}}const Z=j;function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class z extends s.Component{constructor(e){super(e),B(this,"showExportModal",(()=>{this.setState({showExportModal:!0})})),B(this,"hideExportModal",(()=>{this.setState({showExportModal:!1})})),B(this,"showImportModal",(()=>{this.setState({showImportModal:!0})})),B(this,"hideImportModal",(()=>{this.setState({showImportModal:!1})})),B(this,"showDeleteModal",(e=>{this.setState({showDelete:e})})),B(this,"hideDeleteModal",(()=>{this.setState({showDelete:null})})),B(this,"showViewModal",(e=>{this.setState({showView:e})})),B(this,"hideViewModal",(()=>{this.setState({showView:null})})),B(this,"showBlockUI",((e,t)=>{this.props.showBlockUI(e,t)})),B(this,"deleteService",(e=>{this.setState({showDelete:null}),this.props.deleteService(e)})),B(this,"getServiceConfigs",((e,t)=>{var a,r=[],l={},i={},n=null==e||null===(a=e.configs)||void 0===a?void 0:a.filter((e=>"ranger.plugin.audit.filters"!==e.name));t=(0,o.omit)(t,"ranger.plugin.audit.filters");var c=(0,o.keys)(t),m=(0,o.map)(n,"name"),d=(0,o.difference)(c,m);return null==n||n.map((e=>l[void 0!==e.label?e.label:e.name]=t[e.name])),Object.entries(l).map((e=>{var[t,a]=e;return r.push(s.createElement("tr",{key:t},s.createElement("td",null,t),s.createElement("td",null,a||"--")))})),d.map((e=>i[e]=t[e])),r.push(s.createElement("tr",{key:"custom-configs-title"},s.createElement("td",{colSpan:"2"},s.createElement("b",null,"Add New Configurations :")))),(0,o.isEmpty)(i)&&r.push(s.createElement("tr",{key:"custom-configs-empty"},s.createElement("td",null,"--"),s.createElement("td",null,"--"))),Object.entries(i).map((e=>{var[t,a]=e;return r.push(s.createElement("tr",{key:t},s.createElement("td",null,t),s.createElement("td",null,a||"--")))})),r})),B(this,"getFilterResources",(e=>Object.keys(e).map(((t,a)=>{var r=e[t].values;return s.createElement("div",{key:a,className:"clearfix mb-2"},s.createElement("span",{className:"float-start"},s.createElement("b",null,t,": "),r.join()),void 0!==e[t].isExcludes?s.createElement("h6",{className:"d-inline"},e[t].isExcludes?s.createElement("span",{className:"badge bg-dark float-end"},"Exclude"):s.createElement("span",{className:"badge bg-dark float-end"},"Include")):"",void 0!==e[t].isRecursive?s.createElement("h6",{className:"d-inline"},e[t].isRecursive?s.createElement("span",{className:"badge bg-dark float-end"},"Recursive"):s.createElement("span",{className:"badge bg-dark float-end"},"Non Recursive")):"")})))),B(this,"getAuditFilters",(e=>{var t=[],a=(0,o.pick)(e,"ranger.plugin.audit.filters");if((0,o.isEmpty)(a))return t;if((0,o.isEmpty)(a["ranger.plugin.audit.filters"]))return t;try{a=JSON.parse(a["ranger.plugin.audit.filters"].replace(/'/g,'"'))}catch(e){return t.push(s.createElement("tr",{key:"error-service-audit-filter"},s.createElement("td",{className:"text-center",colSpan:"8"},s.createElement(h.A,{variant:"danger"},"Error occured while parsing service audit filter!")))),t}return a.map(((e,a)=>t.push(s.createElement("tr",{key:a},s.createElement("td",{className:"text-center"},1==e.isAudited?s.createElement("h6",null,s.createElement(v.A,{bg:"info"},"Yes")):s.createElement("h6",null,s.createElement(v.A,{bg:"info"},"No"))),s.createElement("td",{className:"text-center"},void 0!==e.accessResult?s.createElement("h6",null,s.createElement(v.A,{bg:"info"},e.accessResult)):"--"),s.createElement("td",{className:"text-center"},void 0!==e.resources?s.createElement("div",{className:"resource-grp"},this.getFilterResources(e.resources)):"--"),s.createElement("td",{className:"text-center"},void 0!==e.actions?e.actions.map((e=>s.createElement("h6",{key:e},s.createElement(v.A,{bg:"info"},e)))):"--"),s.createElement("td",{className:"text-center"},void 0!==e.accessTypes&&e.accessTypes.length>0?e.accessTypes.map((e=>s.createElement("h6",{key:e},s.createElement(v.A,{bg:"info"},e)))):"--"),s.createElement("td",{className:"text-center"},void 0!==e.users?e.users.map((e=>s.createElement("h6",{key:e},s.createElement(v.A,{bg:"info",className:"m-1 text-truncate more-less-width",title:e,key:e},e)))):"--"),s.createElement("td",{className:"text-center"},void 0!==e.groups?e.groups.map((e=>s.createElement("h6",{key:e},s.createElement(v.A,{bg:"info",className:"m-1 text-truncate more-less-width",title:e,key:e},e)))):"--"),s.createElement("td",{className:"text-center"},void 0!==e.roles?e.roles.map((e=>s.createElement("h6",{key:e},s.createElement(v.A,{bg:"info"},e)))):"--"))))),t})),this.state={serviceDef:this.props.serviceDefData,showExportModal:!1,showImportModal:!1,showDelete:null,showView:null}}render(){var{serviceDef:e,showImportModal:t,showExportModal:a}=this.state;return s.createElement(i.A,{sm:4},s.createElement("div",{className:"position-relative"},s.createElement(f.A,{bordered:!0,hover:!0,size:"sm"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,s.createElement("div",{className:"policy-title clearfix"},s.createElement("span",{className:"float-start"},(0,d.iA)(e.name),e.displayName),this.props.isAdminRole&&s.createElement("span",{className:"float-end"},(0,o.isEmpty)(this.props.selectedZone)?s.createElement(u.N_,{to:"/service/".concat(e.id,"/create"),title:"Add New Service"},s.createElement("i",{className:"fa-fw fa fa-plus"})):s.createElement("a",{className:"not-allowed",title:"Services cannot be added while filtering Security Zones"},s.createElement("i",{className:"fa-fw fa fa-plus"})),s.createElement("a",{className:"text-decoration cursor-pointer",onClick:this.showImportModal,title:"Import","data-id":"uploadBtnOnServices","data-cy":"uploadBtnOnServices"},s.createElement("i",{className:"fa-fw fa fa-rotate-180 fa-external-link-square"})),s.createElement("a",{className:"text-decoration cursor-pointer",onClick:this.showExportModal,title:"Export","data-id":"downloadBtnOnService","data-cy":"downloadBtnOnService"},s.createElement("i",{className:"fa-fw fa fa-external-link-square"})),t&&s.createElement(Z,{serviceDef:e,services:this.props.servicesData,zones:this.props.zones,isParentImport:!1,selectedZone:this.props.selectedZone,show:t,onHide:this.hideImportModal,showBlockUI:this.showBlockUI,allServices:this.props.allServices}),a&&s.createElement(O,{serviceDef:[e],services:this.props.servicesData,zone:this.props.selectedZone.label,isParentExport:!1,show:a,onHide:this.hideExportModal,showBlockUI:this.showBlockUI})))))),s.createElement("tbody",{className:"table-service-scroll"},this.props.servicesData.map((e=>s.createElement("tr",{key:e.id,className:"d-table w-100"},s.createElement("td",null,s.createElement("div",{className:"clearfix"},s.createElement("span",{className:"float-start"},!e.isEnabled&&s.createElement("i",{className:"fa-fw fa fa-ban text-color-red fa-lg",title:"Disable"}),s.createElement(u.N_,{to:{pathname:"/service/".concat(e.id,"/policies/").concat(b.Kp.RANGER_ACCESS_POLICY_TYPE.value),detail:this.props.selectedZone},className:"service-name text-info"},void 0!==e.displayName?e.displayName:e.name)),s.createElement("span",{className:"float-end"},!this.props.isUserRole&&s.createElement(r.A,{variant:"outline-dark",className:"m-r-5 btn btn-mini",title:"View",onClick:()=>{this.showViewModal(e.id)},"data-name":"viewService","data-id":e.id,"data-cy":e.id},s.createElement("i",{className:"fa-fw fa fa-eye"})),s.createElement(E.A,{show:this.state.showView===e.id,onHide:this.hideViewModal,size:"xl"},s.createElement(E.A.Header,{closeButton:!0},s.createElement(E.A.Title,null,"Service Details")),s.createElement(E.A.Body,null,s.createElement("p",{className:"form-header"},"Service Details :"),s.createElement("div",{className:"overflow-auto"},s.createElement(f.A,{bordered:!0,size:"sm"},s.createElement("tbody",{className:"service-details"},s.createElement("tr",null,s.createElement("td",{className:"text-nowrap"},"Service Name"),s.createElement("td",{className:"text-break"},e.name)),s.createElement("tr",null,s.createElement("td",{className:"text-nowrap"},"Display Name"),s.createElement("td",{className:"text-break"},e.displayName)),s.createElement("tr",null,s.createElement("td",{className:"text-nowrap"},"Description"),s.createElement("td",{className:"text-break"},e.description?e.description:"--")),s.createElement("tr",null,s.createElement("td",{className:"text-nowrap"},"Active Status"),s.createElement("td",null,s.createElement("h6",null,s.createElement(v.A,{bg:"info"},e.isEnabled?"Enabled":"Disabled")))),s.createElement("tr",null,s.createElement("td",{className:"text-nowrap"},"Tag Service"),s.createElement("td",{className:"text-break"},e.tagService?s.createElement("h6",null,s.createElement(v.A,{bg:"info"},e.tagService)):"--"))))),s.createElement("p",{className:"form-header"},"Config Properties :"),s.createElement("div",{className:"table-responsive"},s.createElement(f.A,{bordered:!0,size:"sm"},s.createElement("tbody",{className:"service-config"},(null==e?void 0:e.configs)&&this.getServiceConfigs(this.state.serviceDef,e.configs)))),s.createElement("p",{className:"form-header"},"Audit Filter :"),s.createElement("div",{className:"table-responsive"},s.createElement(f.A,{bordered:!0,size:"sm",className:"table-audit-filter-ready-only"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,"Is Audited"),s.createElement("th",null,"Access Result"),s.createElement("th",null,"Resources"),s.createElement("th",null,"Operations"),s.createElement("th",null,"Permissions"),s.createElement("th",null,"Users"),s.createElement("th",null,"Groups"),s.createElement("th",null,"Roles"))),s.createElement("tbody",{className:"service-audit"},this.getAuditFilters(e.configs))))),s.createElement(E.A.Footer,null,s.createElement(r.A,{variant:"primary",size:"sm",onClick:this.hideViewModal},"OK"))),this.props.isAdminRole&&s.createElement(s.Fragment,null,s.createElement(u.N_,{className:"btn btn-mini m-r-5",title:"Edit",to:"/service/".concat(this.state.serviceDef.id,"/edit/").concat(e.id),state:"services","data-id":e.id,"data-cy":e.id},s.createElement("i",{className:"fa-fw fa fa-edit"})),s.createElement(r.A,{title:"Delete",className:"btn btn-mini btn-danger",onClick:()=>{this.showDeleteModal(e.id)},"data-id":e.id,"data-cy":e.id},s.createElement("i",{className:"fa-fw fa fa-trash"})),s.createElement(E.A,{show:this.state.showDelete===e.id,onHide:this.hideDeleteModal},s.createElement(E.A.Header,{closeButton:!0},s.createElement("span",{className:"text-word-break"},'Are you sure want to delete service "',s.createElement("b",null,"".concat(null==e?void 0:e.displayName)),'" ?')),s.createElement(E.A.Footer,null,s.createElement(r.A,{variant:"secondary",size:"sm",title:"Cancel",onClick:this.hideDeleteModal},"Cancel"),s.createElement(r.A,{variant:"primary",size:"sm",title:"Yes",onClick:()=>this.deleteService(e.id)},"Yes"))))))))))))))}}const R=z;var U=a(4283);function V(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function H(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?V(Object(a),!0).forEach((function(t){q(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):V(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function J(e,t,a,s,r,l,i){try{var n=e[l](i),c=n.value}catch(e){return void a(e)}n.done?t(c):Promise.resolve(c).then(s,r)}function K(e){return function(){var t=this,a=arguments;return new Promise((function(s,r){var l=e.apply(t,a);function i(e){J(l,s,r,i,n,"next",e)}function n(e){J(l,s,r,i,n,"throw",e)}i(void 0)}))}}function q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Y extends s.Component{constructor(e){var t;super(e),t=this,q(this,"initialFetchResp",K((function*(){yield t.fetchServices(),t.state.isKMSRole||(yield t.fetchZones())}))),q(this,"showExportModal",(()=>{this.setState({showExportModal:!0})})),q(this,"hideExportModal",(()=>{this.setState({showExportModal:!1})})),q(this,"showImportModal",(()=>{this.setState({showImportModal:!0})})),q(this,"hideImportModal",(()=>{this.setState({showImportModal:!1})})),q(this,"showBlockUI",((e,t)=>{1==e&&this.setState({blockUI:e}),void 0!==(null==t?void 0:t.status)&&null!==(null==t?void 0:t.status)&&this.setState({blockUI:!1})})),q(this,"fetchZones",K((function*(){t.props.disableTabs(!0),t.setState({loader:!0});var e=[];try{e=(yield(0,m.fetchApi)({url:"public/v2/api/zone-headers"})).data}catch(e){console.error("Error occurred while fetching Zones! ".concat(e))}t.setState({zones:(0,o.sortBy)(e,["name"]),loader:!1}),t.props.disableTabs(!1),t.getSelectedZone(t.state.selectedZone)}))),q(this,"fetchServices",K((function*(){t.props.disableTabs(!0),t.setState({loader:!0});var e=[],a=[],s=[];try{e=yield(0,m.fetchApi)({url:"plugins/services"}),t.state.isTagView?s=(0,o.filter)(e.data.services,["type","tag"]):a=t.state.isKMSRole?(0,o.filter)(e.data.services,(e=>"kms"==e.type)):(0,o.filter)(e.data.services,(e=>"tag"!==e.type&&"kms"!==e.type))}catch(e){console.error("Error occurred while fetching Services or CSRF headers! ".concat(e))}t.setState({allServices:e.data.services,services:t.state.isTagView?s:a,filterServices:t.state.isTagView?s:a,loader:!1}),t.props.disableTabs(!1)}))),q(this,"getSelectedZone",function(){var e=K((function*(e){t.props.disableTabs(!0),t.setState({loader:!0});try{var a=[];if(e&&void 0!==e){var s=yield(0,m.fetchApi)({url:"public/v2/api/zones/".concat(e&&e.value,"/service-headers")});(a=(null==s?void 0:s.data)||[])&&t.props.navigate("".concat(t.props.location.pathname,"?securityZone=").concat(e.label));var r=(0,o.map)(a,"name").map((e=>t.state.services.filter((t=>t.name===e))));r=r.flat(),r=t.state.isTagView?(0,o.filter)(r,(function(e){return"tag"===e.type})):(0,o.filter)(r,(function(e){return"tag"!==e.type}));var l,i=(0,o.uniq)((0,o.map)(r,"type"));l=(0,o.sortBy)(i.map((e=>t.state.serviceDefs.find((t=>t.name==e)))),"id");var n={};n.label=e.label,n.value=e.value,localStorage.setItem("zoneDetails",JSON.stringify(n)),t.setState({filterServiceDefs:l,filterServices:r,selectedZone:{label:e.label,value:e.value},loader:!1}),t.props.disableTabs(!1)}else localStorage.removeItem("zoneDetails"),t.props.navigate(t.props.location.pathname),t.setState({filterServiceDefs:t.state.serviceDefs,filterServices:t.state.services,selectedZone:"",loader:!1}),t.props.disableTabs(!1)}catch(e){console.error("Error occurred while fetching Zone Services ! ".concat(e))}}));return function(t){return e.apply(this,arguments)}}()),q(this,"deleteService",function(){var e=K((function*(e){var a=localStorage.getItem("zoneDetails"),s=[];try{if(t.setState({blockUI:!0}),yield(0,m.fetchApi)({url:"plugins/services/".concat(e),method:"delete"}),null!=a){var r,l=[],i=yield(0,m.fetchApi)({url:"public/v2/api/zones/".concat(null===(r=JSON.parse(a))||void 0===r?void 0:r.value,"/service-headers")});if(s=(null==i?void 0:i.data)||[],!(0,o.isEmpty)(s)){var n,p=(0,o.filter)(s,["isTagService",!1]),u=null===(n=p=(0,o.map)(p,"name"))||void 0===n?void 0:n.map((e=>{var a;return null===(a=t.state.services)||void 0===a?void 0:a.filter((t=>t.name===e))})),h=(0,o.uniq)((0,o.map)(null==u?void 0:u.flat(),"type"));l=(0,o.sortBy)(null==h?void 0:h.map((e=>{var a;return null===(a=t.state.serviceDefs)||void 0===a?void 0:a.find((t=>t.name==e))})),"id")}t.setState({filterServiceDefs:l})}t.setState({services:t.state.services.filter((t=>t.id!==e)),filterServices:t.state.filterServices.filter((t=>t.id!==e)),blockUI:!1}),c.oR.success("Successfully deleted the service"),t.props.navigate(t.props.location.pathname)}catch(a){t.setState({blockUI:!1}),(0,d.ig)(a),console.error("Error occurred while deleting Service id - ".concat(e,"!  ").concat(a))}}));return function(t){return e.apply(this,arguments)}}()),q(this,"Theme",(e=>H(H({},e),{},{colors:H(H({},e.colors),{},{primary:"#0081ab"})}))),q(this,"formatOptionLabel",(e=>{var{label:t}=e;return s.createElement("div",{title:t,className:"text-truncate"},t)})),this.serviceDefData=(0,o.cloneDeep)((0,U.Ji)()),this.state={serviceDefs:this.props.isTagView?this.serviceDefData.tagServiceDefs:this.serviceDefData.serviceDefs,filterServiceDefs:this.props.isTagView?this.serviceDefData.tagServiceDefs:this.serviceDefData.serviceDefs,services:[],filterServices:[],allServices:[],selectedZone:JSON.parse(localStorage.getItem("zoneDetails"))||"",zones:[],isTagView:this.props.isTagView,showExportModal:!1,showImportModal:!1,isAdminRole:(0,d.FV)()||(0,d.Xm)(),isAuditorRole:(0,d.Dl)()||(0,d.EH)(),isUserRole:(0,d.QY)(),isKMSRole:(0,d.Xm)()||(0,d.EH)(),loader:!0,blockUI:!1}}componentDidMount(){this.initialFetchResp()}render(){var{filterServiceDefs:e,filterServices:t,zones:a,selectedZone:c,showExportModal:m,showImportModal:d,isAdminRole:p,isUserRole:u,isKMSRole:h}=this.state,v={control:e=>H(H({},e),{},{minHeight:"33px",height:"33px"}),indicatorsContainer:e=>H(H({},e),{},{height:"33px"}),valueContainer:e=>H(H({},e),{},{paddingTop:"0px"})};return s.createElement(s.Fragment,null,s.createElement("div",null,s.createElement("div",{className:"text-end px-3 pt-3"},!h&&s.createElement("div",{className:"body bold  pd-b-10",style:{display:"inline-block"}},"Security Zone :"),!h&&s.createElement("div",{style:{display:"inline-block",width:"220px",textAlign:"left",verticalAlign:"middle",cursor:"not-allowed"},title:"".concat((0,o.isEmpty)(a)?"Create zone first":""," "),className:"mg-l-5"},s.createElement(n.Ay,{className:(0,o.isEmpty)(a)?"not-allowed":"pe-auto",styles:v,value:(0,o.isEmpty)(this.state.selectedZone)?"":{label:this.state.selectedZone&&this.state.selectedZone.label,value:this.state.selectedZone&&this.state.selectedZone.value},formatOptionLabel:this.formatOptionLabel,isDisabled:!!(0,o.isEmpty)(a),onChange:this.getSelectedZone,isClearable:!0,components:{IndicatorSeparator:()=>null},theme:this.Theme,options:a.map((e=>({value:e.id,label:e.name}))),menuPlacement:"auto",placeholder:"Select Zone Name"})),p&&s.createElement(r.A,{variant:"outline-secondary",size:"sm",className:"".concat((0,o.isEmpty)(e)?"not-allowed":"pe-auto"," ms-2"),onClick:this.showImportModal,"data-id":"importBtn","data-cy":"importBtn",disabled:!!(0,o.isEmpty)(e)},s.createElement("i",{className:"fa fa-fw fa-rotate-180 fa-external-link-square"}),"Import"),(null==e?void 0:e.length)>0&&d&&s.createElement(Z,{serviceDef:e,services:t,zones:a,zone:c.label,isParentImport:!0,show:d,onHide:this.hideImportModal,showBlockUI:this.showBlockUI,allServices:this.state.allServices}),p&&s.createElement(r.A,{variant:"outline-secondary",size:"sm",className:"".concat((0,o.isEmpty)(e)?"not-allowed":"pe-auto"," ms-2"),onClick:this.showExportModal,"data-id":"exportBtn","data-cy":"exportBtn",disabled:!!(0,o.isEmpty)(e)},s.createElement("i",{className:"fa fa-fw fa-external-link-square"}),"Export"),(null==e?void 0:e.length)>0&&m&&s.createElement(O,{serviceDef:e,services:t,zone:c.label,isParentExport:!0,show:m,onHide:this.hideExportModal,showBlockUI:this.showBlockUI}))),this.state.loader?s.createElement(y.aH,null):s.createElement("div",{className:"wrap policy-manager"},(0,o.isEmpty)(e)?s.createElement(l.A,{className:"justify-content-md-center"},s.createElement(i.A,{md:"auto"},s.createElement("div",{className:"pt-5 pr-5"},s.createElement("img",{alt:"No Services",className:"w-50 p-3 d-block mx-auto",src:"../images/07a63a045987fd91a0e1deee9d334e30.svg"})))):s.createElement(l.A,null,null==e?void 0:e.map((e=>s.createElement(R,{key:e&&e.id,serviceDefData:e,servicesData:(0,o.sortBy)(t.filter((t=>t.type===e.name)),"name"),deleteService:this.deleteService,selectedZone:c,zones:a,isAdminRole:p,isUserRole:u,showBlockUI:this.showBlockUI,allServices:this.state.allServices})))),s.createElement(y.Yh,{isUiBlock:this.state.blockUI})))}}const _=(0,p.A)(Y);var L=a(9567),G=a(5056),X=a(4699);function Q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class W extends s.Component{constructor(e){super(e),Q(this,"tabChange",(e=>{this.props.navigate("/policymanager/".concat(e))})),Q(this,"activeTab",(()=>{var e;return this.props.location.pathname&&("/policymanager/resource"==this.props.location.pathname?e="resource":"/policymanager/tag"==this.props.location.pathname&&(e="tag")),e})),Q(this,"disableTabs",(e=>{[{id:"resourceSelectedZone",className:"disabledEvents"},{id:"tagSelectedZone",className:"disabledEvents"},{selector:"sidebar-header",className:"disabledEvents"},{id:"rangerIcon",className:"disabledCursor"}].forEach((t=>{var a,s=t.id?document.getElementById(t.id):null===(a=document.getElementsByClassName(t.selector))||void 0===a?void 0:a[0];s&&(e?s.classList.add(t.className):s.classList.remove(t.className))})),this.setState({loader:e})})),this.state={isTagView:this.props.isTagView,activeKey:this.activeTab(),loader:!1}}componentDidUpdate(e,t){var a=this.activeTab();t.activeKey!==a&&this.setState({activeKey:this.activeTab()})}render(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"header-wraper"},s.createElement("h3",{className:"wrap-header bold"},"Service Manager"),s.createElement(X.A,null)),s.createElement(L.A,{id:"ServiceManager",activeKey:this.state.activeKey,onSelect:e=>this.tabChange(e),className:"".concat(this.state.loader?"not-allowed":"")},(0,d.bw)("Resource Based Policies")&&s.createElement(G.A,{eventKey:"resource",title:"Resource",disabled:!!this.state.loader},!this.state.isTagView&&s.createElement(_,{isTagView:this.state.isTagView,disableTabs:this.disableTabs})),(0,d.bw)("Tag Based Policies")&&s.createElement(G.A,{eventKey:"tag",title:"Tag",disabled:!!this.state.loader},this.state.isTagView&&s.createElement(_,{isTagView:this.state.isTagView,disableTabs:this.disableTabs}))))}}const $=(0,p.A)(W)}}]);