"use strict";(self.webpackChunkranger=self.webpackChunkranger||[]).push([[155],{9423:(e,t,a)=>{a.d(t,{A:()=>v});var l=a(6540),r=a(8914),n=a(616),c=a(2431),s=a(1461),o=a(2543),i=["indeterminate","chkType"];function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},d.apply(this,arguments)}var y=(0,l.forwardRef)(((e,t)=>{var{indeterminate:a,chkType:r}=e,n=function(e,t){if(null==e)return{};var a,l,r=function(e,t){if(null==e)return{};var a,l,r={},n=Object.keys(e);for(l=0;l<n.length;l++)a=n[l],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(l=0;l<n.length;l++)a=n[l],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}(e,i),c=(0,l.useRef)(),s=t||c;return(0,l.useEffect)((()=>{s.current.indeterminate=a}),[s,a]),l.createElement(l.Fragment,null,l.createElement("input",d({type:"checkbox",ref:s},n,{className:"".concat("header"===r?"tablethcheckbox":"tabletdcheckbox")})))}));const v=function(e){var t,a,i,{columns:m,loading:p,data:v,fetchData:E,showPagination:f=!0,pageCount:g,currentpageIndex:b,currentpageSize:h,rowSelectOp:N,columnHide:x,columnSort:P,clientSideSorting:w,columnResizable:A,totalCount:O,defaultSort:S=[],getRowProps:C=(()=>({}))}=e,{getTableProps:D,getTableBodyProps:k,headerGroups:T,rows:B,prepareRow:R,pageCount:j,gotoPage:H,nextPage:z,previousPage:L,setPageSize:I,canPreviousPage:F,allColumns:V,canNextPage:G,pageOptions:U,state:{pageIndex:M,pageSize:J,sortBy:q},selectedFlatRows:Z}=(0,r.useTable)({columns:m,data:v,initialState:{pageIndex:b||0,pageSize:h||25,sortBy:S||[],hiddenColumns:(i=[],null!=localStorage.getItem("showHideTableCol")&&(i=!(0,o.isEmpty)(localStorage.getItem("showHideTableCol"))&&JSON.parse(localStorage.getItem("showHideTableCol"))),(0,o.isEmpty)(i[null==x?void 0:x.tableName])?[]:null===(t=i[null==x?void 0:x.tableName])||void 0===t||null===(a=t.filter((e=>0==e.renderable)))||void 0===a?void 0:a.map((e=>e.name)))},manualPagination:!0,manualSortBy:!w&&!0,disableSortBy:!P,pageCount:g,autoResetPage:!1},r.useResizeColumns,r.useFlexLayout,r.useSortBy,r.usePagination,r.useRowSelect,(e=>{e.visibleColumns.push((e=>{var t=[];if(N){var a={id:"selection",Header:e=>{var{getToggleAllPageRowsSelectedProps:t}=e;return l.createElement("div",null,l.createElement(y,d({},t(),{chkType:"header"})))},Cell:e=>{var{row:t}=e;return l.createElement("div",{className:"text-center"},l.createElement(y,t.getToggleRowSelectedProps()))},width:40};N&&"first"===N.position?t.push(a,...e):t.push(...e,a)}else t=[...e];return t}))})),K=(0,l.useRef)(),[Y,_]=(0,l.useState)("");(0,l.useEffect)((()=>{E({pageIndex:M,pageSize:J,gotoPage:H,sortBy:q})}),[E,M,J,H,!w&&q]),(0,l.useEffect)((()=>{N&&(N.selectedRows.current=Z)}),[Z]),(0,l.useEffect)((()=>{_(M+1)}),[M]);var X=(0,o.groupBy)(V,"parent[id]");delete X.undefined;var W=V.map((e=>{var t;return{columnName:null!=e&&e.parent?"Group(".concat(null==e?void 0:e.parent.id,")"):"Non-Group(".concat(null==e?void 0:e.id,")"),columnData:X[null===(t=e.parent)||void 0===t?void 0:t.id]||e}})),Q=(0,o.uniqBy)(W,(function(e){return e.columnName})),$=[];return l.createElement(l.Fragment,null,(null==x?void 0:x.isVisible)&&l.createElement("div",{className:"position-absolute top-0 end-0"},l.createElement(s.A,{className:"p-0 column-dropdown",align:"end",as:n.A,size:"sm",id:"dropdown-variants-info",variant:"info",title:"Columns"},l.createElement("div",{className:"column-dropdown-maxheight"},l.createElement("ul",{className:"list-group fnt-14"},Q.map(((e,t)=>{var a,r;e.columnName=="Non-Group(".concat(e.columnData.id,")")?$.push({name:e.columnData.id,renderable:e.columnData.isVisible}):e.columnData.forEach((e=>{$.push({name:e.id,renderable:e.isVisible})}));var n=u(u({},JSON.parse(localStorage.getItem("showHideTableCol"))||{}),{},{[x.tableName]:$});return localStorage.setItem("showHideTableCol",JSON.stringify(n)),e.columnName=="Non-Group(".concat(e.columnData.id,")")?l.createElement("li",{className:"column-list text-truncate",key:"col-".concat(t)},l.createElement("label",{title:e.columnData.Header,className:"d-flex align-items-center"},l.createElement("input",d({className:"me-1",type:"checkbox"},e.columnData.getToggleHiddenProps())),e.columnData.Header)):l.createElement("li",{className:"column-list text-truncate",key:"col-".concat(t)},void 0!==e.columnName&&l.createElement("div",{className:"font-weight-bold text-secondary mb-2 fnt-14"},void 0!==e.columnName&&(null==e||null===(a=e.columnData[0])||void 0===a||null===(r=a.parent)||void 0===r?void 0:r.id)),e.columnData.map((e=>l.createElement("ul",{key:e.id,className:"p-0"},l.createElement("li",{className:" list-unstyled"}," ",l.createElement("label",{title:e.Header,className:"d-flex align-items-center"},l.createElement("input",d({className:"me-1",type:"checkbox"},e.getToggleHiddenProps())),e.Header))))))})))))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-sm-12"},l.createElement("div",{className:"table-responsive"},l.createElement(c.A,d({bordered:!0,hover:!0},D()),l.createElement(l.Fragment,null,l.createElement("thead",{className:"thead-light text-center"},T.map((e=>l.createElement("tr",e.getHeaderGroupProps(),e.headers.map((e=>l.createElement("th",d({},e.getHeaderProps([{className:e.className}]),e.getHeaderProps(e.getSortByToggleProps()),{title:void 0,onClick:()=>P&&e.toggleSortBy&&e.toggleSortBy(!e.isSortedDesc)}),A&&!e.disableResizing&&l.createElement(l.Fragment,null,l.createElement("div",d({className:"fa fa-expand","aria-hidden":"true"},e.getResizerProps([{className:"resizer"}]),{onClick:e=>e.stopPropagation()})),l.createElement("i",d({className:"fa fa-expand resizeable-icon","aria-hidden":"true"},e.getResizerProps()))),e.render("Header"),P&&e.isSorted&&l.createElement("span",null,e.isSortedDesc?" ▼":" ▲")))))))),p?l.createElement("tbody",null,l.createElement("tr",null,l.createElement("td",null,l.createElement("center",null,l.createElement("i",{className:"fa fa-spinner fa-pulse fa-lg fa-fw"}))))):0===B.length&&0==p?l.createElement("tbody",null,l.createElement("tr",null,l.createElement("td",{colSpan:m.length+1},l.createElement("center",null,l.createElement("span",{className:"text-muted","data-cy":"tbleDataMsg"},'"No data to show!!"'))))):l.createElement("tbody",k(),B.map((e=>(R(e),l.createElement("tr",d({},e.getRowProps(C(e)),{id:e.original.id}),e.cells.map((e=>l.createElement("td",e.getCellProps(),e.render("Cell")))))))))))),f&&O>25&&l.createElement("div",{className:"row mt-2"},l.createElement("div",{className:"col-md-12 m-b-sm"},l.createElement("div",{className:"text-center d-flex justify-content-end align-items-center pb-2"},l.createElement("span",null,"Records per page",l.createElement("select",{className:"select-pagesize ms-2",value:J,onChange:e=>{H(0),I(Number(e.target.value)),_(1),K.current.value=1}},[25,50,75,100].map((e=>l.createElement("option",{key:e,value:e},e))))),l.createElement("button",{title:"First",onClick:()=>{H(0),K.current.value=1,_(1)},disabled:!F,className:"pagination-btn-last btn btn-outline-dark btn-sm me-1"},l.createElement("i",{className:"fa fa-angle-double-left","aria-hidden":"true"})),l.createElement("button",{title:"Previous",onClick:()=>{K.current.value=M,L(),_(M)},disabled:!F,className:"pagination-btn-previous btn btn-outline-dark btn-sm me-2"},l.createElement("i",{className:"fa fa-angle-left","aria-hidden":"true"})),"Page"," ",l.createElement("div",{className:"position-relative ms-1"},l.createElement("input",{className:"pagination-input",type:"number",ref:K,key:M+1,defaultValue:M+1,onChange:e=>{setTimeout((()=>{var t=e.target.value;if(_(t),t<1||t>U.length||!Number.isInteger(Number(t)))return t;var a=t?Number(t)-1:0;H(a)}),2e3)}}),""!==Y&&(Y<1||Y>U.length||!Number.isInteger(Number(Y)))&&((e,t)=>{var a="";return Number.isInteger(Number(Y))?e<1?a="Value must be greater than or equal to 1":e>t.length&&(a="Value must be less than or equal to ".concat(t.length)):a="Please enter a valid value.",l.createElement("span",{className:"text-danger position-absolute text-start pagination-error-field"},a)})(Y,U),l.createElement("span",{className:"me-1"}," ")),l.createElement("span",{className:"me-1"},l.createElement("span",{className:"me-1"}," "),"of ",U.length),l.createElement("span",{className:"me-1"}," "),l.createElement("button",{onClick:()=>{K.current.value=M+2,z(),_(M+2)},className:"pagination-btn-previous me-1 btn btn-outline-dark btn-sm lh-1",disabled:!G},l.createElement("i",{className:"fa fa-angle-right","aria-hidden":"true"})),l.createElement("button",{onClick:()=>{H(j-1),K.current.value=j,_(j)},className:"pagination-btn-last btn btn-outline btn-sm",disabled:!G},l.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"}))))))))}},3155:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var l=a(6540),r=a(8106),n=a(4479),c=a(1105),s=a(4468),o=a(1100),i=a(5615),m=a(4062),u=a(616),p=a(952),d=a(6005),y=a(8539),v=a(3943),E=a(2543),f=a(6474),g=a(3267),b=a(5787),h=a(8651),N=a(6052),x=a(2465),P=a(2431),w=a(9423),A=a(3666);function O(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function C(e,t,a,l,r,n,c){try{var s=e[n](c),o=s.value}catch(e){return void a(e)}s.done?t(o):Promise.resolve(o).then(l,r)}const D=function(e){var[t,a]=(0,l.useState)([]),r=(0,l.useRef)(0),[o,m]=(0,l.useState)(!0),[u,p]=(0,l.useState)(0),[d,y]=l.useState(0),[v,f]=(0,l.useState)(null),[P,D]=(0,l.useState)(!1),T=(0,l.useCallback)(function(){var t,l=(t=function*(t){var{pageSize:l,pageIndex:n}=t;m(!0);var c,s=++r.current,o=[],i=0,u=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O(Object(a),!0).forEach((function(t){S(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e.searchParams);if(s===r.current){u.serviceType=e.serviceDef.name,u.pageSize=l,u.startIndex=n*l;try{o=(c=yield(0,g.fetchApi)({url:"plugins/policies",params:u})).data.policies,i=c.data.totalCount}catch(e){"Error occurred while fetching Service Policies ! ".concat(e)}a(o),p(i),y(Math.ceil(i/l)),m(!1)}},function(){var e=this,a=arguments;return new Promise((function(l,r){var n=t.apply(e,a);function c(e){C(n,l,r,c,s,"next",e)}function s(e){C(n,l,r,c,s,"throw",e)}c(void 0)}))});return function(e){return l.apply(this,arguments)}}(),[e.searchParams]),B=l.useMemo((()=>[{Header:"Policy ID",accessor:"id",Cell:t=>{return(0,A.Dl)()||(0,A.EH)()?l.createElement("div",{className:"position-relative text-center"},t.value):l.createElement("div",{className:"position-relative text-center"},l.createElement(h.N_,{title:"Edit",to:"/service/".concat((a=t.row.original.service,(0,E.find)(e.services,{name:a}).id),"/policies/").concat(t.value,"/edit")},t.value));var a},width:65},{Header:"Policy Name",accessor:"name",Cell:e=>l.createElement("span",{className:"text-truncate",style:{maxWidth:"120px",display:"inline-block"}},e.value)},{Header:"Policy Label",accessor:"policyLabels",Cell:e=>{var t,a=null==e||null===(t=e.value)||void 0===t?void 0:t.map(((e,t)=>l.createElement("span",{key:t},e)));return(0,E.isEmpty)(a)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:a,key:e.row.original.id})}},{Header:"Resources",accessor:"resources",Cell:e=>{if(e.value){var t=Object.keys(e.value);return null==t?void 0:t.map(((t,a)=>{var r=e.value[t].values;return l.createElement("div",{key:a,className:"text-center overflow-text"},l.createElement("b",null,t,": "),r.join())}))}}},{Header:"Policy Type",accessor:"policyType",Cell:e=>1==e.value?l.createElement("h6",{className:"text-center"},l.createElement(N.A,{bg:"primary"},"Masking")):2==e.value?l.createElement("h6",{className:"text-center"},l.createElement(N.A,{bg:"primary"},"Row Level Filter")):l.createElement("h6",{className:"text-center"},l.createElement(N.A,{bg:"primary"},"Access"))},{Header:"Status",accessor:"isEnabled",Cell:e=>e.value?l.createElement("h6",{className:"text-center"},l.createElement(N.A,{bg:"success"},"Enabled")):l.createElement("h6",{className:"text-center"},l.createElement(N.A,{bg:"danger"},"Disabled"))},{Header:"Zone Name",accessor:"zoneName",Cell:e=>(0,E.isEmpty)(e.value)?l.createElement("div",{className:"text-center"},"--"):l.createElement(N.A,{bg:"dark",className:"text-truncate mw-100"},e.value)},{Header:"Policy Conditions",Cell:e=>{var{row:{original:t}}=e;return l.createElement("div",{className:"text-center"},l.createElement(i.A,{variant:"outline-dark",size:"sm",title:"View",onClick:e=>{e.stopPropagation(),(e=>{D(!0),f(e)})(t)}},l.createElement("div",{className:"text-center"},l.createElement("i",{className:"fa-fw fa fa-plus"}))))}}]),[]);return l.createElement(n.A,null,l.createElement(c.A,{sm:12,className:"mt-3"},l.createElement(s.A,{defaultActiveKey:"0"},l.createElement(s.A.Item,{eventKey:"0"},l.createElement(s.A.Header,{"data-js":"hdfsHeader","data-cy":"hdfsHeader"},l.createElement("div",{className:"clearfix"},l.createElement("span",{className:"bold float-start text-uppercase"},e.serviceDef.name),l.createElement("span",{className:"float-end"}))),l.createElement(s.A.Body,null,e.contentLoader?l.createElement(b.aH,null):l.createElement(w.A,{columnHide:!1,loading:o,data:t,columns:B,fetchData:T,pagination:!0,pageCount:d,totalCount:u})))),l.createElement(x.A,{show:P,onHide:()=>D(!1),size:"lg"},l.createElement(x.A.Header,{closeButton:!0},l.createElement(x.A.Title,null,"Policy Condition Details")),l.createElement(x.A.Body,null,l.createElement(k,{policyData:v,serviceDef:e.serviceDef})))))};function k(e){var t,a,r,n,c,s,o,i,m,u,p=t=>{var a,r=[],n=[];return(0,E.isEmpty)(t)?r.push(l.createElement("tr",{key:"no-data"},l.createElement("td",{className:"text-center",colSpan:(0,E.isEmpty)(null==e||null===(a=e.serviceDef)||void 0===a?void 0:a.policyConditions)?"4":"5"},l.createElement("span",{className:"text-muted"},'"No data to show!!"')))):r=null==t?void 0:t.map(((t,a)=>{var r,c;return n=null===(r=t.accesses)||void 0===r?void 0:r.map((e=>e.type)),l.createElement("tr",{key:a},l.createElement("td",null,(0,E.isEmpty)(t.roles)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:t.roles})),l.createElement("td",null,(0,E.isEmpty)(t.groups)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:t.groups})),l.createElement("td",null,(0,E.isEmpty)(t.users)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:t.users})),!(0,E.isEmpty)(null==e||null===(c=e.serviceDef)||void 0===c?void 0:c.policyConditions)&&l.createElement("td",{className:"text-center"},(0,E.isEmpty)(t.conditions)?"--":t.conditions.map(((e,t)=>l.createElement("h6",{className:"d-inline me-1",key:t},l.createElement(N.A,{bg:"info",className:"d-inline me-1",key:e.values},"".concat(e.type,": ").concat(e.values.join(", "))))))),l.createElement("td",null,(0,E.isEmpty)(n)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:n})))})),r};return l.createElement(l.Fragment,null,0==e.policyData.policyType&&l.createElement(l.Fragment,null,l.createElement("p",{className:"form-header"},"Allow Conditions"),l.createElement("div",{className:"overflow-x-auto"},l.createElement(P.A,{bordered:!0,size:"sm",className:"mb-3 table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Roles"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Users"),!(0,E.isEmpty)(null==e||null===(t=e.serviceDef)||void 0===t?void 0:t.policyConditions)&&l.createElement("th",{className:"text-center text-nowrap"},"Policy Conditions"),l.createElement("th",null,"Accesses"))),l.createElement("tbody",null,p(e.policyData.policyItems)))),"true"==(null===(a=e.serviceDef)||void 0===a||null===(r=a.options)||void 0===r?void 0:r.enableDenyAndExceptionsInPolicies)&&l.createElement(l.Fragment,null,l.createElement("p",{className:"form-header"},"Allow Exclude"),l.createElement("div",{className:"overflow-x-auto"},l.createElement(P.A,{bordered:!0,size:"sm",className:"mb-3 table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Roles"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Users"),!(0,E.isEmpty)(null==e||null===(n=e.serviceDef)||void 0===n?void 0:n.policyConditions)&&l.createElement("th",{className:"text-center text-nowrap"},"Policy Conditions"),l.createElement("th",null,"Accesses"))),l.createElement("tbody",null,p(e.policyData.allowExceptions)))),l.createElement("p",{className:"form-header"},"Deny Conditions"),l.createElement("div",{className:"overflow-x-auto"},l.createElement(P.A,{bordered:!0,size:"sm",className:"mb-3 table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Roles"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Users"),!(0,E.isEmpty)(null==e||null===(c=e.serviceDef)||void 0===c?void 0:c.policyConditions)&&l.createElement("th",{className:"text-center text-nowrap"},"Policy Conditions"),l.createElement("th",null,"Accesses"))),l.createElement("tbody",null,p(e.policyData.denyPolicyItems)))),l.createElement("p",{className:"form-header"},"Deny Exclude"),l.createElement("div",{className:"overflow-x-auto"},l.createElement(P.A,{bordered:!0,size:"sm",className:"mb-3 table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Roles"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Users"),!(0,E.isEmpty)(null==e||null===(s=e.serviceDef)||void 0===s?void 0:s.policyConditions)&&l.createElement("th",{className:"text-center text-nowrap"},"Policy Conditions"),l.createElement("th",null,"Accesses"))),l.createElement("tbody",null,p(e.policyData.denyExceptions)))))),1==e.policyData.policyType&&l.createElement(l.Fragment,null,l.createElement("p",{className:"form-header "},"Masking Conditions"),l.createElement("div",{className:"overflow-x-auto"},l.createElement(P.A,{bordered:!0,size:"sm",className:"mb-3 table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Roles"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Users"),!(0,E.isEmpty)(null==e||null===(o=e.serviceDef)||void 0===o?void 0:o.policyConditions)&&l.createElement("th",{className:"text-center text-nowrap"},"Policy Conditions"),l.createElement("th",null,"Accesses"),l.createElement("th",null,"Masking Condition"))),l.createElement("tbody",null,(t=>{var a,r=[],n=[];return(0,E.isEmpty)(t)?r.push(l.createElement("tr",{key:"no-data"},l.createElement("td",{className:"text-center",colSpan:(0,E.isEmpty)(null==e||null===(a=e.serviceDef)||void 0===a?void 0:a.policyConditions)?"4":"5"},l.createElement("span",{className:"text-muted"},'"No data to show!!"')))):r=null==t?void 0:t.map(((t,a)=>{var r,c;return n=null===(r=t.accesses)||void 0===r?void 0:r.map((e=>e.type)),l.createElement("tr",{key:a},l.createElement("td",null,(0,E.isEmpty)(t.roles)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:t.roles})),l.createElement("td",null,(0,E.isEmpty)(t.groups)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:t.groups})),l.createElement("td",null,(0,E.isEmpty)(t.users)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:t.users})),!(0,E.isEmpty)(null==e||null===(c=e.serviceDef)||void 0===c?void 0:c.policyConditions)&&l.createElement("td",{className:"text-center"},(0,E.isEmpty)(t.conditions)?"--":t.conditions.map(((e,t)=>l.createElement("h6",{className:"d-inline me-1",key:t},l.createElement(N.A,{bg:"info",className:"d-inline me-1",key:e.values},"".concat(e.type,": ").concat(e.values.join(", "))))))),l.createElement("td",null,(0,E.isEmpty)(n)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:n})),l.createElement("td",null,(0,E.isEmpty)(t.dataMaskInfo)?"--":l.createElement("h6",{className:"d-inline"},l.createElement(N.A,{bg:"info",className:"me-1"},t.dataMaskInfo.dataMaskType))))})),r})(e.policyData.dataMaskPolicyItems))))),2==e.policyData.policyType&&l.createElement(l.Fragment,null,l.createElement("p",{className:"form-header"},"Row Level Conditions"),l.createElement("div",{className:"overflow-x-auto"},l.createElement(P.A,{bordered:!0,size:"sm",className:"mb-3 table-audit-filter-ready-only"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Roles"),l.createElement("th",null,"Groups"),l.createElement("th",null,"Users"),l.createElement("th",null,"Accesses"),l.createElement("th",null,"Row Level Filter"))),l.createElement("tbody",null,(i=e.policyData.rowFilterPolicyItems,m=[],u=[],(0,E.isEmpty)(i)?m.push(l.createElement("tr",{key:"no-data"},l.createElement("td",{className:"text-center",colSpan:"4"},l.createElement("span",{className:"text-muted"},'"No data to show!!"')))):m=null==i?void 0:i.map(((e,t)=>{var a;return u=null===(a=e.accesses)||void 0===a?void 0:a.map((e=>e.type)),l.createElement("tr",{key:t},l.createElement("td",null,(0,E.isEmpty)(e.roles)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:e.roles})),l.createElement("td",null,(0,E.isEmpty)(e.groups)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:e.groups})),l.createElement("td",null,(0,E.isEmpty)(e.users)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:e.users})),l.createElement("td",null,(0,E.isEmpty)(u)?l.createElement("div",{className:"text-center"},"--"):l.createElement(b.LH,{data:u})),l.createElement("td",null,(0,E.isEmpty)(e.rowFilterInfo)?"--":l.createElement("h6",{className:"d-inline"},l.createElement(N.A,{bg:"info",className:"me-1"},e.rowFilterInfo.filterExpr))))})),m))))))}var T=a(4699),B=a(4743),R=a.n(B),j=a(4283);function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(Object(a),!0).forEach((function(t){L(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function L(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},I.apply(this,arguments)}function F(e,t,a,l,r,n,c){try{var s=e[n](c),o=s.value}catch(e){return void a(e)}s.done?t(o):Promise.resolve(o).then(l,r)}function V(e){return function(){var t=this,a=arguments;return new Promise((function(l,r){var n=e.apply(t,a);function c(e){F(n,l,r,c,s,"next",e)}function s(e){F(n,l,r,c,s,"throw",e)}c(void 0)}))}}const G=function(){var e=(0,A.Xm)()||(0,A.EH)(),t=(0,A.Dl)()||(0,A.EH)(),[a,y]=(0,l.useState)(!0),[h,N]=(0,l.useState)([]),[x,P]=(0,l.useState)([]),[w,O]=(0,l.useState)([]),[S,C]=(0,l.useState)([]),[k,B]=(0,l.useState)([]),[H,z]=(0,l.useState)([]),[L,F]=(0,l.useState)({}),G=(0,r.Zp)(),M=(0,r.zy)(),J=(0,b.IT)(),{allServiceDefs:q}=(0,E.cloneDeep)((0,j.Ji)());(0,l.useEffect)((()=>{Z(),e||Y(),y(!1)}),[]),(0,l.useEffect)((()=>{W()}),[J]);var Z=function(){var e=V((function*(){yield K()}));return function(){return e.apply(this,arguments)}}(),K=function(){var t=V((function*(){var t,a;try{t=yield(0,g.fetchApi)({url:"plugins/services"}),a=(0,E.filter)(t.data.services,(t=>e?"kms"==t.type:"kms"!=t.type))}catch(e){console.error("Error occurred while fetching Services or CSRF headers! ".concat(e))}var l=(0,E.filter)(q,(t=>e?"kms"==t.name:"kms"!=t.name)),r=l;J.get("serviceType")&&(r=[],(0,E.split)(J.get("serviceType"),",").map((e=>{var t=(0,E.find)(l,{name:e});(0,E.isUndefined)(t)||r.push(t)})));var n=(0,E.map)(q,(function(e){return{value:e.name,label:e.name}}));N(l),C(a),P(r),O(n)}));return function(){return t.apply(this,arguments)}}(),Y=function(){var e=V((function*(){var e=[];try{var t=yield(0,g.fetchApi)({url:"public/v2/api/zone-headers"});e=(null==t?void 0:t.data)||[]}catch(e){console.error("Error occurred while fetching Zones! ".concat(e))}var a=(0,E.map)((0,E.sortBy)(e,["name"]),(function(e){return{value:e.name,label:e.name}}));B(e||[]),z(a)}));return function(){return e.apply(this,arguments)}}(),_=function(){var e=V((function*(e){var t={};e&&(t.policyLabel=e||"");var a=yield(0,g.fetchApi)({url:"plugins/policyLabels",params:t});return(0,E.map)(a.data,(function(e){return{value:e,label:e}}))}));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=V((function*(e){var t="",a={};void 0!==e.policyType&&(t="policyType=".concat(e.policyType.value),a.policyType=e.policyType.value),void 0!==e.policyNamePartial&&(t="".concat(t,"&policyNamePartial=").concat(e.policyNamePartial),a.policyNamePartial=e.policyNamePartial);var l=h;if(void 0!==e.serviceType&&!(0,E.isEmpty)(e.serviceType)){var r=(0,E.join)((0,E.map)(e.serviceType,"value"));l=(0,E.map)((0,E.map)(e.serviceType,"value"),(function(e){return(0,E.find)(h,{name:e})})),t="".concat(t,"&serviceType=").concat(r),a.serviceType=r}void 0!==e.polResource&&(t="".concat(t,"&polResource=").concat(e.polResource),a.polResource=e.polResource),void 0!==e.policyLabelsPartial&&e.policyLabelsPartial&&(t="".concat(t,"&policyLabelsPartial=").concat(e.policyLabelsPartial.value),a.policyLabelsPartial=e.policyLabelsPartial.value),void 0!==e.zoneName&&e.zoneName&&(t="".concat(t,"&zoneName=").concat(e.zoneName.value),a.zoneName=e.zoneName.value,Q(e.zoneName.value)),void 0!==e.searchByValue&&e.searchByValue&&("searchByUser"==e.searchBy.value?(t="".concat(t,"&user=").concat(e.searchByValue.value),a.user=e.searchByValue.value):"searchByRole"==e.searchBy.value?(t="".concat(t,"&role=").concat(e.searchByValue.value),a.role=e.searchByValue.value):(t="".concat(t,"&group=").concat(e.searchByValue.value),a.group=e.searchByValue.value)),G("/reports/userAccess?".concat(t)),P(l),F(a)}));return function(t){return e.apply(this,arguments)}}(),W=()=>{var t={},a=(0,E.filter)(h,(t=>e?"kms"==t.name:"kms"!=t.name)),l=[...a];if(J.get("policyNamePartial")&&(t.policyNamePartial=J.get("policyNamePartial")),J.get("policyType")&&(t.policyType=J.get("policyType")),J.get("serviceType")){t.serviceType=J.get("serviceType"),l=[];var r=(0,E.split)(J.get("serviceType"),",");(0,E.uniq)(r).map((e=>{var t=(0,E.find)(a,{name:e});(0,E.isUndefined)(t)||l.push(t)}))}if(J.get("polResource")&&(t.polResource=J.get("polResource")),J.get("policyLabelsPartial")&&(t.policyLabelsPartial=J.get("policyLabelsPartial")),J.get("zoneName")&&(t.zoneName=J.get("zoneName"),Q(J.get("zoneName"))),J.get("user")&&(t.user=J.get("user")),J.get("group")&&(t.group=J.get("group")),J.get("role")&&(t.role=J.get("role")),JSON.stringify(L)!==JSON.stringify(t)&&((0,E.has)(t,"serviceType")&&(t.serviceType=(0,E.uniq)(t.serviceType.split(",")).join(",")),F(t),P(l),(0,E.has)(Object.fromEntries(J),"policyType")||(J.set("policyType","0"),t.policyType="0",G("".concat(M.pathname,"?").concat(J)),F(t)),(0,E.has)(t,"serviceType"))){var n=t.serviceType.split(",");J.set("serviceType",(0,E.uniq)(n).join(",")),G("".concat(M.pathname,"?").concat(J))}},Q=e=>{var t={},a=(0,E.find)(k,{name:e});a&&(t.label=e,t.value=a.id,localStorage.setItem("zoneDetails",JSON.stringify(t)))},$=function(){var e=V((function*(e){var t,a="/plugins/policies/exportJson";"downloadExcel"===e?a="/plugins/policies/downloadExcel":"csv"===e&&(a="/plugins/policies/csv");try{200===(t=yield(0,g.fetchApi)({url:a,params:L,responseType:"blob"})).status?ee({exportType:e,apiResponse:t.data}):f.oR.warning("No policies found to export")}catch(e){console.error("Error occurred while exporting policies ".concat(e))}}));return function(t){return e.apply(this,arguments)}}(),ee=e=>{var t,{exportType:a,apiResponse:l}=e;t="downloadExcel"===a?".xls":"csv"===a?".csv":".json";var r="Ranger_Policies_"+R()(R()()).format("YYYYMMDD_hhmmss")+t,n=window.URL.createObjectURL(l),c=document.createElement("a");c.href=n,c.download=r;var s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});document.body.appendChild(c),c.dispatchEvent(s),c.remove()};return l.createElement(l.Fragment,null,l.createElement("div",{className:"clearfix"},l.createElement("div",{className:"header-wraper"},l.createElement("h3",{className:"wrap-header bold"},"Reports"),l.createElement(T.A,null))),l.createElement("div",{className:"wrap report-page"},l.createElement(n.A,null,l.createElement(c.A,{sm:12},l.createElement(s.A,{defaultActiveKey:"0"},l.createElement(s.A.Item,{eventKey:"0"},l.createElement(s.A.Header,null,l.createElement("div",{className:"clearfix"},l.createElement("span",{className:"bold float-start"},"Search Criteria"))),l.createElement(s.A.Body,null,l.createElement(p.lV,{onSubmit:X,initialValues:()=>{var e,t={};if(J.get("policyNamePartial")&&(t.policyNamePartial=J.get("policyNamePartial")),J.get("policyType")&&(e=1==J.get("policyType")?"Masking":2==J.get("policyType")?"Row Level Filter":"Access",t.policyType={value:J.get("policyType"),label:e}),J.get("serviceType")){var a=(0,E.split)(J.get("serviceType"),",");t.serviceType=(0,E.map)(a,(function(e){return{value:e,label:e}}))}return J.get("polResource")&&(t.polResource=J.get("polResource")),J.get("policyLabelsPartial")&&(t.policyLabelsPartial={value:J.get("policyLabelsPartial"),label:J.get("policyLabelsPartial")}),J.get("zoneName")&&(t.zoneName={value:J.get("zoneName"),label:J.get("zoneName")}),t.searchBy={value:"searchByGroup",label:"Group"},J.get("user")&&(t.searchBy={value:"searchByUser",label:"Username"},t.searchByValue={value:J.get("user"),label:J.get("user")}),J.get("role")&&(t.searchBy={value:"searchByRole",label:"Rolename"},t.searchByValue={value:J.get("role"),label:J.get("role")}),J.get("group")&&(t.searchByValue={value:J.get("group"),label:J.get("group")}),t},render:t=>{var{handleSubmit:a,submitting:r,values:s}=t;return l.createElement("form",{onSubmit:a},l.createElement(n.A,{className:"form-group"},l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Policy Name")),l.createElement(c.A,{sm:4},l.createElement(p.D0,{name:"policyNamePartial"},(e=>{var{input:t}=e;return l.createElement("input",I({},t,{type:"text",placeholder:"Enter Policy Name",className:"form-control","data-js":"policyName","data-cy":"policyName"}))}))),l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Policy Type")),l.createElement(c.A,{sm:4},l.createElement(p.D0,{name:"policyType"},(e=>{var{input:t}=e;return l.createElement(d.Ay,I({},t,{isClearable:!1,options:[{value:"0",label:"Access"},{value:"1",label:"Masking"},{value:"2",label:"Row Level Filter"}],menuPlacement:"auto",placeholder:"Select Policy Type"}))})))),l.createElement(n.A,{className:"form-group"},l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Component")),l.createElement(c.A,{sm:4},l.createElement(p.D0,{name:"serviceType"},(e=>{var{input:t}=e;return l.createElement(d.Ay,I({},t,{isMulti:!0,isClearable:!1,options:w,menuPlacement:"auto",placeholder:"Select Component Type",styles:b.eB}))}))),l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Resource")),l.createElement(c.A,{sm:4},l.createElement(p.D0,{name:"polResource"},(e=>{var{input:t}=e;return l.createElement("input",I({},t,{type:"text",placeholder:"Enter Resource Name",className:"form-control","data-js":"resourceName","data-cy":"resourceName"}))})))),l.createElement(n.A,{className:"form-group"},l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Policy Label")),l.createElement(c.A,{sm:4},l.createElement(p.D0,{name:"policyLabelsPartial"},(e=>{var{input:t}=e;return l.createElement(v.A,I({},t,{defaultOptions:!0,isClearable:!0,loadOptions:_,placeholder:"Select Policy Label",styles:b.eB}))}))),!e&&l.createElement(l.Fragment,null,l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Zone Name")),l.createElement(c.A,{sm:4},l.createElement(p.D0,{name:"zoneName"},(e=>{var{input:t}=e;return l.createElement(d.Ay,I({},t,{isClearable:!0,options:H,menuPlacement:"auto",placeholder:"Select Zone Name",styles:b.eB}))}))))),l.createElement(n.A,null,l.createElement(c.A,{sm:2,className:"text-end"},l.createElement("label",{className:"col-form-label "},"Search By")),l.createElement(c.A,{sm:10},l.createElement(o.A,{className:"mb-3"},l.createElement(p.D0,{name:"searchBy"},(e=>{var{input:t}=e;return l.createElement(d.Ay,I({},t,{isClearable:!1,options:[{value:"searchByGroup",label:"Groupname"},{value:"searchByUser",label:"Username"},{value:"searchByRole",label:"Rolename"}],menuPlacement:"auto",placeholder:"Select Search By",onChange:e=>((e,t,a)=>{for(var l in e.label!==t.value.label&&delete a.searchByValue,t.value)delete t.value[l];t.onChange({value:e.value,label:e.label})})(e,t,s)}))})),l.createElement(U,{searchByOptName:s.searchBy,onChange:(e,t)=>((e,t)=>{t.onChange(e)})(e,t)})))),l.createElement(n.A,null,l.createElement(c.A,{sm:{span:10,offset:2}},l.createElement(i.A,{variant:"primary",type:"submit",size:"sm",disabled:r,"data-js":"searchBtn","data-cy":"searchBtn"},l.createElement("i",{className:"fa-fw fa fa-search"}),"Search"))))}})))))),l.createElement(n.A,null,l.createElement(c.A,{sm:12,className:"mt-3 text-end"},l.createElement(m.A,{as:u.A,key:"left",drop:"start",size:"sm",className:"manage-export",title:"Export all below policies"},l.createElement(m.A.Toggle,{"data-name":"downloadFormatBtn","data-cy":"downloadFormatBtn"},l.createElement("i",{className:"fa-fw fa fa-external-link-square"})," Export"),l.createElement(m.A.Menu,null,l.createElement(m.A.Item,{onClick:()=>$("downloadExcel")},"Excel file"),l.createElement(m.A.Divider,null),l.createElement(m.A.Item,{onClick:()=>$("csv")},"CSV file"),!t&&l.createElement(l.Fragment,null,l.createElement(m.A.Divider,null),l.createElement(m.A.Item,{onClick:()=>$("exportJson")},"JSON file")))))),null==x?void 0:x.map((e=>l.createElement(D,{key:e.name,serviceDef:e,services:S,searchParams:L,searchParamsUrl:M.search,contentLoader:a})))))};function U(e){var[t,a]=(0,l.useState)({value:"searchByGroup",label:"Group"});(0,l.useEffect)((()=>{a(e.searchByOptName)}),[e.searchByOptName]);var r={control:e=>z(z({},e),{},{minHeight:"30px",height:"38px",marginLeft:5}),indicatorsContainer:e=>z(z({},e),{},{height:"30px"}),valueContainer:e=>z(z({},e),{},{width:215,padding:4})},n=function(){var e=V((function*(e){var a="",l={},r=[];return e&&(l.name=e||""),"searchByGroup"==t.value?a="xusers/lookup/groups":"searchByUser"==t.value?a="xusers/lookup/users":"searchByRole"==t.value&&(a="roles/roles"),(0,E.isEmpty)(a)||(r=yield(0,g.fetchApi)({url:a,params:l})),"searchByUser"==t.value?r.data.vXStrings.map((e=>({label:e.value,value:e.value}))):"searchByRole"==t.value?r.data.roles.map((e=>{var{name:t}=e;return{label:t,value:t}})):r.data.vXStrings.map((e=>({label:e.value,value:e.value})))}));return function(t){return e.apply(this,arguments)}}();return l.createElement(p.D0,{name:"searchByValue"},(a=>{var{input:c}=a;return l.createElement(y.A,I({},c,{key:JSON.stringify(t),onChange:t=>((t,a)=>{"function"==typeof e.onChange&&e.onChange(t,a)})(t,c),styles:r,cacheOptions:!0,isClearable:!0,defaultOptions:!0,loadOptions:n,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null}}))}))}}}]);