"use strict";(self.webpackChunkranger=self.webpackChunkranger||[]).push([[688],{9688:(e,r,t)=>{t.r(r),t.d(r,{default:()=>_});var a=t(952),n=t(475),l=t(4479),s=t(1105),o=t(2431),i=t(5615),c=t(778),u=t(6540),d=t(8106),m=t(5787),p=t(3267),E=t(8539),v=t(6474),f=t(2543),g=t(1376),b=t(3666);function h(){return h=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},h.apply(this,arguments)}function y(e,r,t,a,n,l,s){try{var o=e[l](s),i=o.value}catch(e){return void t(e)}o.done?r(i):Promise.resolve(i).then(a,n)}function D(e){return function(){var r=this,t=arguments;return new Promise((function(a,n){var l=e.apply(r,t);function s(e){y(l,a,n,s,o,"next",e)}function o(e){y(l,a,n,s,o,"throw",e)}s(void 0)}))}}function S(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function A(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?S(Object(t),!0).forEach((function(r){I(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function I(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var N={loader:!0,permissionData:null,selectedGrp:[],selectedUsr:[],usrloading:!1,grploading:!1,blockUI:!1};function O(e,r){switch(r.type){case"SET_DATA":return A(A({},e),{},{loader:!1,permissionData:r.data,selectedGrp:r.grpData,selectedUsr:r.usrData});case"SET_SELECTED_GRP":return A(A({},e),{},{selectedGrp:r.grpData,grploading:!1});case"SET_SELECTED_USR":return A(A({},e),{},{selectedUsr:r.usrData,usrloading:!1});case"USR_LOADING":return A(A({},e),{},{usrloading:!0});case"GRP_LOADING":return A(A({},e),{},{grploading:!0});case"SET_BLOCK_UI":return A(A({},e),{},{blockUI:r.blockUI});default:throw new Error}}const _=()=>{var{permissionId:e}=(0,d.g)(),r=(0,d.Zp)(),t=(0,u.useRef)(null),[y,S]=(0,u.useReducer)(O,N),{loader:A,permissionData:I,usrloading:_,grploading:P,selectedGrp:U,selectedUsr:G,blockUI:L}=y;(0,u.useEffect)((()=>{T()}),[]);var w=function(){var a=D((function*(a){var n=(0,f.cloneDeep)(a);if(a.selectGroups&&a.selectGroups.length>0||a.selectuser&&a.selectuser.length>0)return v.oR.dismiss(t.current),t.current=v.oR.error("Please add selected user/group to permissions else user/group will not be added."),!1;for(var l of n.groupPermList)-1===(0,f.findIndex)(U,{value:l.groupId})&&(l.isAllowed=g.iv.ACCESS_RESULT_DENIED.value);for(var s of U)(0,f.find)(n.groupPermList,{groupId:s.value})||n.groupPermList.push({groupId:s.value,isAllowed:g.iv.ACCESS_RESULT_ALLOWED.value,moduleId:n.id});for(var o of n.userPermList)-1===(0,f.findIndex)(G,{value:o.userId})&&(o.isAllowed=g.iv.ACCESS_RESULT_DENIED.value);for(var i of G)(0,f.find)(n.userPermList,{userId:i.value})||n.userPermList.push({userId:i.value,isAllowed:g.iv.ACCESS_RESULT_ALLOWED.value,moduleId:n.id});try{S({type:"SET_BLOCK_UI",blockUI:!0}),yield(0,p.fetchApi)({url:"xusers/permission/".concat(e),method:"PUT",data:n}),S({type:"SET_BLOCK_UI",blockUI:!1}),r("/permissions/models"),v.oR.dismiss(t.current),t.current=v.oR.success("Success! Module Permissions updated successfully")}catch(e){S({type:"SET_BLOCK_UI",blockUI:!1}),console.error("Error occurred while fetching Policies ! ".concat(e)),(0,b.ig)(e)}}));return function(e){return a.apply(this,arguments)}}(),T=function(){var r=D((function*(){var r,t,a,n,l,s,o=null;try{var i=yield(0,p.fetchApi)({url:"xusers/permission/".concat(e),params:{}});o=null==i?void 0:i.data}catch(e){console.error("Error occurred while fetching Permissions ! ".concat(e))}l=(0,f.reverse)(null===(r=o)||void 0===r?void 0:r.groupPermList),s=(0,f.reverse)(null===(t=o)||void 0===t?void 0:t.userPermList),S({type:"SET_DATA",data:o,grpData:null===(a=l)||void 0===a?void 0:a.map((e=>({label:e.groupName,value:e.groupId}))),usrData:null===(n=s)||void 0===n?void 0:n.map((e=>({label:e.userName,value:e.userId})))})}));return function(){return r.apply(this,arguments)}}(),R=function(){var e=D((function*(e){var r={isVisible:1},t=[];e&&(r.name=e||"");try{var a;t=null===(a=(yield(0,p.fetchApi)({url:"xusers/groups",params:r})).data)||void 0===a?void 0:a.vXGroups}catch(e){console.error("Error occurred while fetching Groups ! ".concat(e)),(0,b.ig)(e)}return(0,f.map)(t,(function(e){return{label:e.name,value:e.id}}))}));return function(r){return e.apply(this,arguments)}}(),C=e=>{var{data:r}=e;return-1===(0,f.findIndex)(U,r)},x=e=>{S({type:"GRP_LOADING"}),setTimeout((()=>{var r=(0,f.findIndex)(U,e);-1!==r&&(U.splice(r,1),S({type:"SET_SELECTED_GRP",grpData:U}))}),100)},k=function(){var e=D((function*(e){var r={isVisible:1},t=[],a=["ROLE_KEY_ADMIN","ROLE_KEY_ADMIN_AUDITOR"];e&&(r.name=e||"");try{var n,l,s=yield(0,p.fetchApi)({url:"xusers/users",params:r});t="Tag Based Policies"==I.module?null===(n=s.data)||void 0===n?void 0:n.vXUsers.filter((e=>!a.includes(e.userRoleList[0]))):null===(l=s.data)||void 0===l?void 0:l.vXUsers}catch(e){console.error("Error occurred while fetching Users ! ".concat(e)),(0,b.ig)(e)}return(0,f.map)(t,(function(e){return{label:e.name,value:e.id}}))}));return function(r){return e.apply(this,arguments)}}(),j=e=>{var{data:r}=e;return-1===(0,f.findIndex)(G,r)},B=e=>{S({type:"USR_LOADING"}),setTimeout((()=>{var r=(0,f.findIndex)(G,e);-1!==r&&(G.splice(r,1),S({type:"SET_SELECTED_USR",usrData:G}))}),100)};return A?u.createElement(m.aH,null):u.createElement("div",null,u.createElement("div",{className:"header-wraper"},u.createElement("h3",{className:"wrap-header bold"},"Edit Permission"),(0,b.zH)(["ModulePermissions","ModulePermissionEdit"],I)),u.createElement("div",{className:"wrap non-collapsible"},u.createElement(a.lV,{id:"myform2",name:"myform2",onSubmit:w,initialValues:I,render:e=>{var{handleSubmit:d,submitting:p,values:g}=e;return u.createElement("form",{onSubmit:d},u.createElement("div",{className:"form-horizontal"},u.createElement("p",{className:"form-header"},"Module Details:"),u.createElement("div",null,u.createElement(a.D0,{className:"form-control",name:"module",render:e=>{var{input:r}=e;return u.createElement(n.A.Group,{as:l.A,className:"mb-3",controlId:"moduleName"},u.createElement(n.A.Label,{column:!0,sm:"3",className:"text-end"},u.createElement("strong",null,"Module Name *")),u.createElement(s.A,{sm:"4"},u.createElement(n.A.Control,h({},r,{disabled:!0}))))}}))),u.createElement("br",null),u.createElement("br",null),u.createElement("div",{className:"form-horizontal"},u.createElement("p",{className:"form-header"},"User and Group Permissions:"),u.createElement(a.D0,{className:"form-control",name:"zoneservices",render:()=>u.createElement(n.A.Group,{as:l.A,className:"mb-3",controlId:"formPlaintextEmail"},u.createElement(n.A.Label,{className:"text-end",column:!0,sm:"2"},"Permissions"),u.createElement(s.A,{sm:"10"},u.createElement(o.A,{bordered:!0},u.createElement("thead",{className:"table-edit-permission"},u.createElement("tr",null,u.createElement("th",{width:"49%"},"Select and Add Group"),u.createElement("th",{width:"49%"},"Select and Add User "))),u.createElement("tbody",null,u.createElement("tr",null,u.createElement("td",null,u.createElement(a.D0,{className:"form-control",name:"selectGroups",render:e=>{var{input:r}=e;return u.createElement("div",null,u.createElement(E.A,h({},r,{className:"edit-perm-select",defaultOptions:!0,filterOption:C,loadOptions:R,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null},isClearable:!1,placeholder:"Select Groups",isMulti:!0,styles:m.eB})),u.createElement(i.A,{size:"sm",className:"ms-2  m-r-sm",variant:"outline-secondary",onClick:()=>{if(!g.selectGroups||0===g.selectGroups.length)return v.oR.dismiss(t.current),t.current=v.oR.error("Please select group!!"),!1;((e,r)=>{S({type:"GRP_LOADING"}),setTimeout((()=>{S({type:"SET_SELECTED_GRP",grpData:[...e.selectGroups,...U]}),r.onChange([])}),100)})(g,r)},"data-id":"addGroupBtn","data-cy":"addGroupBtn"},u.createElement("i",{className:"fa fa-plus"})))}})),u.createElement("td",null,u.createElement(a.D0,{className:"form-control",name:"selectuser",render:e=>{var{input:r}=e;return u.createElement("div",null,u.createElement(E.A,h({},r,{className:"edit-perm-select",defaultOptions:!0,filterOption:j,loadOptions:k,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null},isClearable:!1,placeholder:"Select Users",isMulti:!0,styles:m.eB})),u.createElement(i.A,{size:"sm",className:"ms-2  m-r-sm",variant:"outline-secondary",onClick:()=>{if(!g.selectuser||0===g.selectuser.length)return v.oR.dismiss(t.current),t.current=v.oR.error("Please select user!!"),!1;((e,r)=>{S({type:"USR_LOADING"}),setTimeout((()=>{var t=[...e.selectuser,...G];S({type:"SET_SELECTED_USR",usrData:t}),r.onChange([])}),100)})(g,r)},"data-id":"addUserBtn","data-cy":"addUserBtn"},u.createElement("i",{className:"fa fa-plus"})))}}))),u.createElement("tr",null,(0,f.isEmpty)(U)?u.createElement("td",{className:"align-middle text-center"},u.createElement("strong",{className:"text-danger font-italic"},"No Selected Groups")):u.createElement("td",null,P?u.createElement("div",{className:"permission-infinite-scroll text-center"},u.createElement(c.A,{animation:"border",size:"sm",role:"status"})):u.createElement(b.Gi,{data:U,removeUsrGrp:x,scrollableDiv:"scrollableGrpDiv"})),(0,f.isEmpty)(G)?u.createElement("td",{className:"align-middle text-center"},u.createElement("strong",{className:"text-danger font-italic"},"No Selected Users")):u.createElement("td",null,_?u.createElement("div",{className:"permission-infinite-scroll text-center"},u.createElement(c.A,{animation:"border",size:"sm",role:"status"})):u.createElement(b.Gi,{data:G,removeUsrGrp:B,scrollableDiv:"scrollableUsrDiv"})))))))})),u.createElement("div",{className:"text-center form-actions"},u.createElement(i.A,{type:"submit",variant:"primary",size:"sm",disabled:p,"data-id":"save","data-cy":"save"},"Save"),u.createElement(i.A,{variant:"secondary",size:"sm",type:"button",onClick:()=>{r("/permissions/models")},"data-id":"cancel","data-cy":"cancel"},"Cancel")))}}),u.createElement(m.Yh,{isUiBlock:L})))}}}]);